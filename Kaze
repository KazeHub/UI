--// Kaze UI Base
--// Fixed Window System (PC + Mobile)

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// Auto Scale
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
    local size = workspace.CurrentCamera.ViewportSize
    UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
end

UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// =========================
--// DRAG FUNCTION (PC/MOBILE)
--// =========================
local function MakeDraggable(TopBar, Window)
    local dragging, dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        Window.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Window.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    TopBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

--// =========================
--// CREATE WINDOW
--// =========================
function KazeUI:CreateWindow(config)
    config = config or {}

    local Title      = config.Title or "Kaze Hub"
    local Author     = config.Author or "Unknown"
    local Version    = config.Version or "1.0"
    local IconId     = config.Icon or nil -- Example: "rbxassetid://123456"
    local Callback   = config.Callback

    --// Main Window
    local Window = Instance.new("Frame")
    Window.Name = "MainWindow"
    Window.Size = UDim2.fromOffset(650, 420)
    Window.Position = UDim2.fromScale(0.5, 0.5)
    Window.AnchorPoint = Vector2.new(0.5, 0.5)
    Window.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    Window.BorderSizePixel = 0
    Window.Parent = ScreenGui
    
    local Corner = Instance.new("UICorner", Window)
    Corner.CornerRadius = UDim.new(0, 12)

    --// Glow/Stroke (Animated Blue)
    local Stroke = Instance.new("UIStroke")
    Stroke.Color = Color3.fromRGB(0, 160, 255)
    Stroke.Thickness = 2
    Stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    Stroke.Parent = Window

    -- Glow Animation (Pulsing effect)
    spawn(function()
        while task.wait() do
            local tween = TweenService:Create(Stroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
                Color = Color3.fromRGB(0, 255, 255),
                Thickness = 2.5
            })
            tween:Play()
            break
        end
    end)

    --// TOP BAR
    local TopBar = Instance.new("Frame")
    TopBar.Name = "TopBar"
    TopBar.Size = UDim2.new(1, 0, 0, 50)
    TopBar.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
    TopBar.BorderSizePixel = 0
    TopBar.Parent = Window
    Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 12)
    
    -- Draggable logic
    MakeDraggable(TopBar, Window)

    --// ICON SYSTEM
    local Icon = Instance.new("ImageLabel")
    Icon.Name = "WindowIcon"
    Icon.Size = UDim2.fromOffset(30, 30)
    Icon.Position = UDim2.fromOffset(12, 10)
    Icon.BackgroundTransparency = 1
    Icon.Image = IconId or "rbxassetid://6031763447" -- Default icon if none provided
    Icon.Visible = true
    Icon.Parent = TopBar

    --// Title & Info
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -160, 0, 20)
    TitleLabel.Position = UDim2.fromOffset(50, 8)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = Title
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 16
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = TopBar

    local SubLabel = Instance.new("TextLabel")
    SubLabel.Size = UDim2.new(1, -160, 0, 14)
    SubLabel.Position = UDim2.fromOffset(50, 26)
    SubLabel.BackgroundTransparency = 1
    SubLabel.Text = "by " .. Author .. " | v" .. Version
    SubLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    SubLabel.Font = Enum.Font.Gotham
    SubLabel.TextSize = 12
    SubLabel.TextXAlignment = Enum.TextXAlignment.Left
    SubLabel.Parent = TopBar

    --// Buttons Container
    local BtnContainer = Instance.new("Frame")
    BtnContainer.Size = UDim2.fromOffset(80, 50)
    BtnContainer.Position = UDim2.new(1, -90, 0, 0)
    BtnContainer.BackgroundTransparency = 1
    BtnContainer.Parent = TopBar

    local layout = Instance.new("UIListLayout", BtnContainer)
    layout.FillDirection = Enum.FillDirection.Horizontal
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    layout.VerticalAlignment = Enum.VerticalAlignment.Center
    layout.Padding = UDim.new(0, 8)

    local Minimize = Instance.new("TextButton")
    Minimize.Size = UDim2.fromOffset(32, 32)
    Minimize.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    Minimize.Text = "-"
    Minimize.TextColor3 = Color3.fromRGB(200, 200, 200)
    Minimize.Font = Enum.Font.GothamBold
    Minimize.TextSize = 20
    Minimize.Parent = BtnContainer
    Instance.new("UICorner", Minimize).CornerRadius = UDim.new(0, 8)

    local Close = Instance.new("TextButton")
    Close.Size = UDim2.fromOffset(32, 32)
    Close.BackgroundColor3 = Color3.fromRGB(35, 20, 20)
    Close.Text = "Ã—"
    Close.TextColor3 = Color3.fromRGB(255, 100, 100)
    Close.Font = Enum.Font.GothamBold
    Close.TextSize = 22
    Close.Parent = BtnContainer
    Instance.new("UICorner", Close).CornerRadius = UDim.new(0, 8)

    --// Content
    local Content = Instance.new("Frame")
    Content.Name = "ContentArea"
    Content.Position = UDim2.fromOffset(0, 50)
    Content.Size = UDim2.new(1, 0, 1, -50)
    Content.BackgroundTransparency = 1
    Content.ClipsDescendants = true
    Content.Parent = Window

    --// LOGIC
    local minimized = false
    Minimize.MouseButton1Click:Connect(function()
        minimized = not minimized
        local targetSize = minimized and UDim2.fromOffset(650, 50) or UDim2.fromOffset(650, 420)
        TweenService:Create(Window, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = targetSize}):Play()
        Content.Visible = not minimized
    end)

    Close.MouseButton1Click:Connect(function()
        local t = TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.BackIn), {Size = UDim2.fromOffset(0,0), BackgroundTransparency = 1})
        t:Play()
        t.Completed:Connect(function() ScreenGui:Destroy() end)
    end)

    if typeof(Callback) == "function" then pcall(Callback) end

    return {
        Window = Window,
        Content = Content
    }
end

return KazeUI

		-- Cancel Button
		local CancelBtn = Instance.new("TextButton")
		CancelBtn.Name = "CancelBtn"
		CancelBtn.Size = UDim2.new(0, 120, 0, 36)
		CancelBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
		CancelBtn.Text = "Cancel"
		CancelBtn.Font = Enum.Font.GothamBold
		CancelBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
		CancelBtn.TextSize = 16
		CancelBtn.ZIndex = 23
		CancelBtn.Parent = ButtonsFrame
		Instance.new("UICorner", CancelBtn).CornerRadius = UDim.new(0, 8)

		-- Confirm button callback: destroy UI
		ConfirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)

		-- Cancel button callback: remove overlay and re-enable buttons
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			Minimize.Active = true
			Close.Active = true
		end) 
	end

	Close.MouseButton1Click:Connect(ShowCloseConfirm)

	--// Callback
	if typeof(Callback) == "function" then
		pcall(Callback)
	end

	return {
		Window = Window,
		Content = Content,
		Icon = Icon
	}
end

return KazeUI
