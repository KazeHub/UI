--// Kaze UI - Refactored & Fixed Layout
--// Base on User Screenshot: Tabs Left (Sidebar), Elements Right (Container)

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// ScreenGui Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI_Refactored"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// 1. SMART ICON LOADER
local IconMap = {}
local success, result = pcall(function()
	local data = game:HttpGet("https://raw.githubusercontent.com/KazeHub/UI/refs/heads/main/Icons.lua.txt")
	return loadstring(data)()
end)

if success and type(result) == "table" then
	IconMap = result
else
	-- Fallback icons kung sakaling may error sa GitHub
	IconMap = {home = "6031763447", list = "6031763523", settings = "6031763494"}
end

local function ResolveIcon(input)
	if not input then return "rbxassetid://6031763523" end
	
	-- Kung number ang nilagay (rbxassetid)
	if type(input) == "number" or tonumber(input) then
		return "rbxassetid://" .. tostring(input):gsub("%D", "")
	end
	
	-- Kung string key sa IconMap
	if IconMap[tostring(input)] then
		return "rbxassetid://" .. tostring(IconMap[tostring(input)]):gsub("%D", "")
	end
	
	return "rbxassetid://6031763523" -- Default
end

--// Dragging Logic
local function MakeDraggable(dragPart, targetPart)
	local dragging, dragInput, dragStart, startPos
	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true; dragStart = input.Position; startPos = targetPart.Position
			input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
		end
	end)
	UIS.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			targetPart.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

--// CREATE WINDOW
function KazeUI:CreateWindow(config)
	config = config or {}
	local Title = config.Title or "Kaze Hub"
	local Sub = config.Sub or "Kaze | v2.0"

	-- Main Frame
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = UDim2.fromOffset(600, 380)
	Window.Position = UDim2.fromScale(0.5, 0.5)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	Window.BorderSizePixel = 0
	Window.Parent = ScreenGui
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 10)
	
	local Stroke = Instance.new("UIStroke", Window)
	Stroke.Color = Color3.fromRGB(0, 160, 255)
	Stroke.Thickness = 1.5

	-- Top Bar
	local TopBar = Instance.new("Frame", Window)
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 45)
	TopBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	TopBar.BorderSizePixel = 0
	MakeDraggable(TopBar, Window)

	-- Horizontal Divider (Under TopBar)
	local TopLine = Instance.new("Frame", TopBar)
	TopLine.Size = UDim2.new(1, 0, 0, 1)
	TopLine.Position = UDim2.new(0, 0, 1, 0)
	TopLine.BackgroundColor3 = Color3.fromRGB(0, 160, 255)
	TopLine.BorderSizePixel = 0

	local TitleLabel = Instance.new("TextLabel", TopBar)
	TitleLabel.Text = Title
	TitleLabel.Position = UDim2.fromOffset(15, 8)
	TitleLabel.Size = UDim2.fromOffset(200, 15)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 16
	TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.BackgroundTransparency = 1

	local SubLabel = Instance.new("TextLabel", TopBar)
	SubLabel.Text = Sub
	SubLabel.Position = UDim2.fromOffset(15, 24)
	SubLabel.Size = UDim2.fromOffset(200, 15)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 12
	SubLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.BackgroundTransparency = 1

	-- Close Button
	local Close = Instance.new("TextButton", TopBar)
	Close.Size = UDim2.fromOffset(30, 30)
	Close.Position = UDim2.new(1, -40, 0, 7)
	Close.Text = "âœ•"
	Close.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
	Close.TextColor3 = Color3.fromRGB(255, 100, 100)
	Close.Font = Enum.Font.GothamBold
	Instance.new("UICorner", Close)
	Close.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

	--// 3. SIDEBAR & VERTICAL DIVIDER
	local Sidebar = Instance.new("Frame", Window)
	Sidebar.Name = "Sidebar"
	Sidebar.Position = UDim2.fromOffset(0, 46) -- Below TopBar Line
	Sidebar.Size = UDim2.new(0, 70, 1, -46)
	Sidebar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	Sidebar.BorderSizePixel = 0

	local VerticalLine = Instance.new("Frame", Sidebar)
	VerticalLine.Size = UDim2.new(0, 1, 1, 0)
	VerticalLine.Position = UDim2.new(1, 0, 0, 0)
	VerticalLine.BackgroundColor3 = Color3.fromRGB(0, 160, 255)
	VerticalLine.BorderSizePixel = 0

	local SidebarLayout = Instance.new("UIListLayout", Sidebar)
	SidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	SidebarLayout.Padding = UDim.new(0, 12)
	Instance.new("UIPadding", Sidebar).PaddingTop = UDim.new(0, 15)

	-- Page Container (Right Side)
	local PageContainer = Instance.new("Frame", Window)
	PageContainer.Name = "PageContainer"
	PageContainer.Position = UDim2.fromOffset(85, 60)
	PageContainer.Size = UDim2.new(1, -100, 1, -75)
	PageContainer.BackgroundTransparency = 1

	local WindowObj = { Tabs = {}, ActiveTab = nil }

	--// 2. CREATE TAB (OOP Syntax)
	function WindowObj:CreateTab(arg)
		local title = type(arg) == "table" and arg.Title or arg
		local iconName = type(arg) == "table" and arg.Icon or "list"

		-- Tab Button
		local TabBtn = Instance.new("ImageButton", Sidebar)
		TabBtn.Size = UDim2.fromOffset(40, 40)
		TabBtn.BackgroundTransparency = 1
		TabBtn.Image = ResolveIcon(iconName)
		TabBtn.ImageColor3 = Color3.fromRGB(120, 120, 120)

		-- Indicator
		local Indicator = Instance.new("Frame", TabBtn)
		Indicator.Size = UDim2.new(0, 2, 0.6, 0)
		Indicator.Position = UDim2.fromScale(-0.2, 0.2)
		Indicator.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
		Indicator.BorderSizePixel = 0
		Indicator.Visible = false

		-- Page
		local Page = Instance.new("ScrollingFrame", PageContainer)
		Page.Size = UDim2.fromScale(1, 1)
		Page.BackgroundTransparency = 1
		Page.Visible = false
		Page.ScrollBarThickness = 2
		Page.CanvasSize = UDim2.new(0,0,0,0)
		Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
		
		local PageLayout = Instance.new("UIListLayout", Page)
		PageLayout.Padding = UDim.new(0, 10)

		local Tab = { Page = Page, Btn = TabBtn, Indicator = Indicator }

		local function Activate()
			if WindowObj.ActiveTab then
				WindowObj.ActiveTab.Page.Visible = false
				WindowObj.ActiveTab.Indicator.Visible = false
				TweenService:Create(WindowObj.ActiveTab.Btn, TweenInfo.new(0.3), {ImageColor3 = Color3.fromRGB(120, 120, 120)}):Play()
			end
			Page.Visible = true
			Indicator.Visible = true
			TweenService:Create(TabBtn, TweenInfo.new(0.3), {ImageColor3 = Color3.fromRGB(0, 255, 255)}):Play()
			WindowObj.ActiveTab = Tab
		end

		TabBtn.MouseButton1Click:Connect(Activate)
		if #WindowObj.Tabs == 0 then task.spawn(Activate) end
		table.insert(WindowObj.Tabs, Tab)

		--// TAB ELEMENTS (Section, Button, etc.)
		function Tab:AddSection(text)
			local Label = Instance.new("TextLabel", Page)
			Label.Text = text:upper()
			Label.Size = UDim2.new(1, 0, 0, 25)
			Label.Font = Enum.Font.GothamBold
			Label.TextSize = 14
			Label.TextColor3 = Color3.fromRGB(0, 160, 255)
			Label.TextXAlignment = Enum.TextXAlignment.Left
			Label.BackgroundTransparency = 1
		end

		function Tab:AddButton(text, callback)
			local Btn = Instance.new("TextButton", Page)
			Btn.Text = "      " .. text -- Space for text alignment
			Btn.Size = UDim2.new(1, 0, 0, 38)
			Btn.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
			Btn.TextColor3 = Color3.fromRGB(230, 230, 230)
			Btn.Font = Enum.Font.Gotham
			Btn.TextSize = 14
			Btn.TextXAlignment = Enum.TextXAlignment.Left
			Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)
			
			Btn.MouseButton1Click:Connect(callback)
		end

		return Tab
	end

	return WindowObj
end

return KazeUI
