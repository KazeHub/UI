--// Kaze UI Base
--// Window System (PC + Mobile)
--// Updated: Smart Icon Loader (HTTP), OOP Syntax, Sidebar Divider

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// UIScale for consistent scaling across devices
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	if size.X < 600 then
		UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
	else
		UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
	end
end
UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// 1. SMART ICON LOADER
-- Fetches the icon map from GitHub. Falls back to a small local list if HTTP fails.
local IconMap = {
	home = "6031763447",
	settings = "6031763494",
	list = "6031763523",
	user = "6031763660",
	search = "6031763600"
}

pcall(function()
	local httpData = game:HttpGet("https://raw.githubusercontent.com/KazeHub/UI/refs/heads/main/Icons.lua.txt")
	local loadedTable = loadstring(httpData)()
	if typeof(loadedTable) == "table" then
		for k, v in pairs(loadedTable) do
			IconMap[k] = v -- Merge/Overwrite
		end
	end
end)

local function ResolveIcon(input)
	if not input then return "" end
	local strInput = tostring(input)

	-- Check if it's a named key in our map
	if IconMap[strInput] then
		return "rbxassetid://" .. string.gsub(tostring(IconMap[strInput]), "%D", "")
	end

	-- If it looks like a raw ID (digits), just format it
	local cleanId = string.gsub(strInput, "%D", "")
	if #cleanId > 0 then
		return "rbxassetid://" .. cleanId
	end
	
	-- Fallback if unknown
	return "rbxassetid://" .. (IconMap["list"] or "6031763523")
end

--// Drag Function
local function MakeDraggable(dragPart, targetPart)
	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		if not dragStart or not startPos then return end
		local delta = input.Position - dragStart
		targetPart.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					dragInput = nil
				end
			end)
		end
	end)

	dragPart.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

--// CREATE WINDOW
function KazeUI:CreateWindow(config)
	config = config or {}

	-- Config
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = ResolveIcon(config.Icon or "home")
	local OpenIcon = ResolveIcon((config.OpenButton and config.OpenButton.Icon) or config.Icon or "home")
	local Callback = config.Callback

	--// Main Window
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = UDim2.fromOffset(650, 420)
	Window.Position = UDim2.fromScale(0.5, 0.5)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	Window.BorderSizePixel = 0
	Window.Parent = ScreenGui
	Window.ClipsDescendants = true
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 14)

	local WindowStroke = Instance.new("UIStroke")
	WindowStroke.Color = Color3.fromRGB(0, 160, 255)
	WindowStroke.Thickness = 2.5 
	WindowStroke.Parent = Window

	spawn(function()
		while Window.Parent do
			local t = TweenService:Create(WindowStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	--// Top Bar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 56)
	TopBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	TopBar.BorderSizePixel = 0
	TopBar.Parent = Window
	TopBar.ZIndex = 12
	Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 14)
	MakeDraggable(TopBar, Window)
	
	-- Square off bottom corners
	local TopBarCover = Instance.new("Frame")
	TopBarCover.Size = UDim2.new(1, 0, 0, 10)
	TopBarCover.Position = UDim2.new(0, 0, 1, -10)
	TopBarCover.BackgroundColor3 = TopBar.BackgroundColor3
	TopBarCover.BorderSizePixel = 0
	TopBarCover.Parent = TopBar
	TopBarCover.ZIndex = 12

	local Icon = Instance.new("ImageLabel")
	Icon.Size = UDim2.fromOffset(32, 32)
	Icon.Position = UDim2.fromOffset(14, 12)
	Icon.BackgroundTransparency = 1
	Icon.Image = MainIcon
	Icon.Parent = TopBar
	Icon.ZIndex = 13
	Instance.new("UICorner", Icon).CornerRadius = UDim.new(1, 0)

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, -160, 0, 22)
	TitleLabel.Position = UDim2.fromOffset(56, 8)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(235, 235, 235)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 16
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = TopBar
	TitleLabel.ZIndex = 13

	local SubLabel = Instance.new("TextLabel")
	SubLabel.Size = UDim2.new(1, -160, 0, 18)
	SubLabel.Position = UDim2.fromOffset(56, 30)
	SubLabel.BackgroundTransparency = 1
	SubLabel.Text = Author .. " | v" .. Version
	SubLabel.TextColor3 = Color3.fromRGB(160, 160, 160)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 13
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.Parent = TopBar
	SubLabel.ZIndex = 13

	local Minimize = Instance.new("TextButton")
	Minimize.Size = UDim2.fromOffset(36, 36)
	Minimize.Position = UDim2.new(1, -88, 0.5, -18)
	Minimize.Text = "—"
	Minimize.Font = Enum.Font.GothamBold
	Minimize.TextSize = 20
	Minimize.TextColor3 = Color3.fromRGB(220, 220, 220)
	Minimize.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
	Minimize.Parent = TopBar
	Minimize.ZIndex = 13
	Instance.new("UICorner", Minimize).CornerRadius = UDim.new(1, 0)

	local Close = Instance.new("TextButton")
	Close.Size = UDim2.fromOffset(36, 36)
	Close.Position = UDim2.new(1, -44, 0.5, -18)
	Close.Text = "✕"
	Close.Font = Enum.Font.GothamBold
	Close.TextSize = 18
	Close.TextColor3 = Color3.fromRGB(255, 90, 90)
	Close.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
	Close.Parent = TopBar
	Close.ZIndex = 13
	Instance.new("UICorner", Close).CornerRadius = UDim.new(1, 0)

	local Content = Instance.new("Frame")
	Content.Position = UDim2.fromOffset(0, 56)
	Content.Size = UDim2.new(1, 0, 1, -56)
	Content.BackgroundTransparency = 1
	Content.Parent = Window

	--// 3. Sidebar (Solid + Divider)
	local Sidebar = Instance.new("Frame")
	Sidebar.Name = "Sidebar"
	Sidebar.Size = UDim2.new(0, 70, 1, 0)
	Sidebar.Position = UDim2.fromOffset(0, 0)
	Sidebar.BackgroundColor3 = Color3.fromRGB(15, 15, 20) -- Solid Dark
	Sidebar.BackgroundTransparency = 0 
	Sidebar.BorderSizePixel = 0
	Sidebar.Parent = Content
	Sidebar.ZIndex = 10 
	Sidebar.ClipsDescendants = false

	-- Sidebar Divider (Vertical Line)
	local SidebarDiv = Instance.new("Frame")
	SidebarDiv.Name = "Divider"
	SidebarDiv.Size = UDim2.new(0, 1, 1, 0)
	SidebarDiv.Position = UDim2.new(1, 0, 0, 0)
	SidebarDiv.BackgroundColor3 = Color3.fromRGB(40, 40, 45) -- Subtle grey
	SidebarDiv.BorderSizePixel = 0
	SidebarDiv.Parent = Sidebar
	SidebarDiv.ZIndex = 11

	local sidebarLayout = Instance.new("UIListLayout")
	sidebarLayout.Parent = Sidebar
	sidebarLayout.FillDirection = Enum.FillDirection.Vertical
	sidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
	sidebarLayout.Padding = UDim.new(0, 10)
	sidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	sidebarLayout.VerticalAlignment = Enum.VerticalAlignment.Top

	local sidebarPadding = Instance.new("UIPadding")
	sidebarPadding.Parent = Sidebar
	sidebarPadding.PaddingTop = UDim.new(0, 15)

	--// Page Container
	local PageContainer = Instance.new("Frame")
	PageContainer.Name = "PageContainer"
	PageContainer.Size = UDim2.new(1, -75, 1, 0)
	PageContainer.Position = UDim2.fromOffset(75, 0)
	PageContainer.BackgroundTransparency = 1
	PageContainer.BorderSizePixel = 0
	PageContainer.Parent = Content
	PageContainer.ZIndex = 5

	-- Logic Trackers
	local WindowFunctions = {}
	local pages = {}
	local tabs = {}

	--// 2. OOP TAB SYNTAX & LOGIC
	function WindowFunctions:CreateTab(arg)
		-- Support: CreateTab("Home") OR CreateTab({Title="Home", Icon="home"})
		local tabTitle, tabIcon
		if type(arg) == "table" then
			tabTitle = arg.Title or "Tab"
			tabIcon = ResolveIcon(arg.Icon or "list")
		else
			tabTitle = tostring(arg or "Tab")
			tabIcon = ResolveIcon("list")
		end

		-- Tab Button
		local TabBtn = Instance.new("ImageButton")
		TabBtn.Name = "Tab_" .. tabTitle
		TabBtn.Size = UDim2.fromOffset(45, 45)
		TabBtn.BackgroundTransparency = 1
		TabBtn.Image = tabIcon
		TabBtn.ImageColor3 = Color3.fromRGB(120, 120, 120) -- Default Gray
		TabBtn.ScaleType = Enum.ScaleType.Fit
		TabBtn.Parent = Sidebar
		TabBtn.AutoButtonColor = false
		TabBtn.ZIndex = Sidebar.ZIndex + 1

		-- Neon Indicator (Left side)
		local Indicator = Instance.new("Frame")
		Indicator.Name = "Indicator"
		Indicator.Size = UDim2.fromOffset(3, 30) -- 3px wide
		Indicator.AnchorPoint = Vector2.new(0, 0.5)
		Indicator.Position = UDim2.new(0, 0, 0.5, 0)
		Indicator.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
		Indicator.Visible = false
		Indicator.ZIndex = TabBtn.ZIndex + 1
		Indicator.Parent = TabBtn
		Instance.new("UICorner", Indicator).CornerRadius = UDim.new(0, 2)

		-- Page Frame
		local Page = Instance.new("ScrollingFrame")
		Page.Name = "Page_" .. tabTitle
		Page.Size = UDim2.new(1, 0, 1, 0)
		Page.Position = UDim2.new(0, 0, 0, 0)
		Page.BackgroundTransparency = 1
		Page.BorderSizePixel = 0
		Page.ScrollBarThickness = 4
		Page.ScrollBarImageColor3 = Color3.fromRGB(50, 50, 55)
		Page.CanvasSize = UDim2.new(0, 0, 0, 0)
		Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
		Page.Parent = PageContainer
		Page.Visible = false
		Page.ZIndex = 5

		local pageLayout = Instance.new("UIListLayout")
		pageLayout.Parent = Page
		pageLayout.SortOrder = Enum.SortOrder.LayoutOrder
		pageLayout.Padding = UDim.new(0, 8)
		
		local pagePad = Instance.new("UIPadding")
		pagePad.PaddingTop = UDim.new(0, 10)
		pagePad.PaddingLeft = UDim.new(0, 5)
		pagePad.PaddingRight = UDim.new(0, 10)
		pagePad.PaddingBottom = UDim.new(0, 10)
		pagePad.Parent = Page

		-- Tracking
		table.insert(pages, Page)
		table.insert(tabs, TabBtn)

		-- Activation Logic
		TabBtn.MouseButton1Click:Connect(function()
			-- Deactivate all tabs
			for _, t in ipairs(tabs) do
				TweenService:Create(t, TweenInfo.new(0.2), {ImageColor3 = Color3.fromRGB(120, 120, 120)}):Play()
				if t:FindFirstChild("Indicator") then t.Indicator.Visible = false end
			end
			-- Hide all pages
			for _, p in ipairs(pages) do
				p.Visible = false
			end

			-- Activate THIS tab
			TweenService:Create(TabBtn, TweenInfo.new(0.2), {ImageColor3 = Color3.fromRGB(0, 255, 255)}):Play()
			Indicator.Visible = true
			Page.Visible = true
		end)

		-- Auto-select the first tab
		if #tabs == 1 then
			TabBtn.ImageColor3 = Color3.fromRGB(0, 255, 255)
			Indicator.Visible = true
			Page.Visible = true
		end

		-- Return Tab Object for chaining
		local TabObject = {}

		function TabObject:AddLabel(text)
			local LabelObj = Instance.new("TextLabel")
			LabelObj.Size = UDim2.new(1, 0, 0, 26)
			LabelObj.BackgroundTransparency = 1
			LabelObj.Text = text
			LabelObj.TextColor3 = Color3.fromRGB(255, 255, 255)
			LabelObj.Font = Enum.Font.GothamBold
			LabelObj.TextSize = 14
			LabelObj.TextXAlignment = Enum.TextXAlignment.Left
			LabelObj.Parent = Page
			return LabelObj
		end

		function TabObject:AddButton(btnConfig)
			local bTitle = btnConfig.Title or "Button"
			local bCallback = btnConfig.Callback or function() end

			local BtnFrame = Instance.new("TextButton")
			BtnFrame.Name = "Button"
			BtnFrame.Size = UDim2.new(1, 0, 0, 42)
			BtnFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
			BtnFrame.Text = ""
			BtnFrame.AutoButtonColor = false
			BtnFrame.Parent = Page
			Instance.new("UICorner", BtnFrame).CornerRadius = UDim.new(0, 6)

			local Title = Instance.new("TextLabel")
			Title.Size = UDim2.new(1, -40, 1, 0)
			Title.Position = UDim2.new(0, 12, 0, 0)
			Title.BackgroundTransparency = 1
			Title.Text = bTitle
			Title.TextColor3 = Color3.fromRGB(230, 230, 230)
			Title.Font = Enum.Font.GothamSemibold
			Title.TextSize = 14
			Title.TextXAlignment = Enum.TextXAlignment.Left
			Title.Parent = BtnFrame

			local Ico = Instance.new("ImageLabel")
			Ico.Size = UDim2.fromOffset(20, 20)
			Ico.Position = UDim2.new(1, -30, 0.5, 0)
			Ico.AnchorPoint = Vector2.new(0, 0.5)
			Ico.BackgroundTransparency = 1
			Ico.Image = "rbxassetid://6031763447"
			Ico.ImageColor3 = Color3.fromRGB(150, 150, 150)
			Ico.Parent = BtnFrame

			BtnFrame.MouseEnter:Connect(function()
				TweenService:Create(BtnFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 35, 40)}):Play()
			end)
			BtnFrame.MouseLeave:Connect(function()
				TweenService:Create(BtnFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25, 25, 30)}):Play()
			end)
			BtnFrame.MouseButton1Click:Connect(function()
				pcall(bCallback)
				TweenService:Create(Title, TweenInfo.new(0.1), {TextSize = 12}):Play()
				wait(0.1)
				TweenService:Create(Title, TweenInfo.new(0.1), {TextSize = 14}):Play()
			end)
		end

		return TabObject
	end

	--// Mini Button Logic
	local MiniButton = Instance.new("ImageButton")
	MiniButton.Name = "MiniButton"
	MiniButton.Size = UDim2.fromOffset(60, 60)
	MiniButton.Position = UDim2.fromScale(0.1, 0.1)
	MiniButton.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	MiniButton.Visible = false
	MiniButton.Parent = ScreenGui
	MiniButton.ZIndex = 999
	Instance.new("UICorner", MiniButton).CornerRadius = UDim.new(0, 12)
	
	local MiniIcon = Instance.new("ImageLabel")
	MiniIcon.Size = UDim2.fromScale(0.6, 0.6)
	MiniIcon.Position = UDim2.fromScale(0.5, 0.5)
	MiniIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	MiniIcon.BackgroundTransparency = 1
	MiniIcon.Image = OpenIcon
	MiniIcon.Parent = MiniButton

	local MiniStroke = Instance.new("UIStroke")
	MiniStroke.Color = Color3.fromRGB(0, 160, 255)
	MiniStroke.Thickness = 2.5
	MiniStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	MiniStroke.Parent = MiniButton

	MakeDraggable(MiniButton, MiniButton)

	Minimize.MouseButton1Click:Connect(function()
		Window.Visible = false
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(MiniButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.fromOffset(60, 60)}):Play()
	end)

	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.fromOffset(650, 420)}):Play()
	end)
	
	Close.MouseButton1Click:Connect(function()
		ScreenGui:Destroy()
	end)

	if typeof(Callback) == "function" then pcall(Callback) end

	return WindowFunctions
end

return KazeUI
