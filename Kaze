--// Kaze UI Base (auto-resize + traffic lights on RIGHT, stays above Core UI)
--// Window System (PC + Mobile)
--// Changes:
--  - Window auto-adjusts to viewport (responsive)
--  - ScreenGui.DisplayOrder high + IgnoreGuiInset to avoid being covered by Roblox core UI
--  - Traffic-light controls on right top bar
--  - Tabs / Pages system added (CreateTab / Section / Paragraph)
--  - Restore/minimize use the computed target size

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
-- Ensure the UI appears above Roblox core UI
ScreenGui.DisplayOrder = 9999
-- Ignore the default top/bottom insets so the UI won't be pushed by Roblox topbar
ScreenGui.IgnoreGuiInset = true
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// UIScale for consistent scaling across devices
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	if size.X < 600 then
		UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
	else
		UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
	end
end
UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// Texture ID Sanitizer
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id)
	local clean = string.gsub(id, "%D", "") -- keep only digits
	if clean == "" then return "" end
	return "rbxassetid://" .. clean
end

--// Drag Function (works with Mouse and Touch)
local function MakeDraggable(dragPart, targetPart)
	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		if not dragStart or not startPos then return end
		local delta = input.Position - dragStart
		targetPart.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					dragInput = nil
				end
			end)
		end
	end)

	dragPart.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

-- Local helpers for Tab/Section/Paragraph system (based on user's snippets)
local function CreateParagraph(parent, title, text)
	local Paragraph = {}

	local Frame = Instance.new("Frame")
	Frame.Size = UDim2.new(0.95, 0, 0, 0)
	Frame.BackgroundColor3 = Color3.fromRGB(24, 24, 28)
	Frame.AutomaticSize = Enum.AutomaticSize.Y
	Frame.Parent = parent
	Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 8)

	local Padding = Instance.new("UIPadding")
	Padding.PaddingTop = UDim.new(0, 10)
	Padding.PaddingBottom = UDim.new(0, 10)
	Padding.PaddingLeft = UDim.new(0, 12)
	Padding.PaddingRight = UDim.new(0, 12)
	Padding.Parent = Frame

	if title and title ~= "" then
		local Title = Instance.new("TextLabel")
		Title.Size = UDim2.new(1, 0, 0, 20)
		Title.BackgroundTransparency = 1
		Title.Text = title
		Title.TextWrapped = true
		Title.TextXAlignment = Enum.TextXAlignment.Left
		Title.TextColor3 = Color3.fromRGB(255, 255, 255)
		Title.Font = Enum.Font.GothamBold
		Title.TextSize = 16
		Title.Parent = Frame
	end

	local Body = Instance.new("TextLabel")
	Body.Size = UDim2.new(1, 0, 0, 0)
	Body.BackgroundTransparency = 1
	Body.TextWrapped = true
	Body.AutomaticSize = Enum.AutomaticSize.Y
	Body.TextXAlignment = Enum.TextXAlignment.Left
	Body.TextYAlignment = Enum.TextYAlignment.Top
	Body.Text = text or ""
	Body.TextColor3 = Color3.fromRGB(220, 220, 220)
	Body.Font = Enum.Font.Gotham
	Body.TextSize = 14
	Body.Parent = Frame

	function Paragraph:SetText(newText)
		Body.Text = tostring(newText or "")
	end

	return Paragraph
end

local function CreateSection(parent, title)
	local Section = {}

	local SectionFrame = Instance.new("Frame")
	SectionFrame.Size = UDim2.new(1, -24, 0, 0)
	SectionFrame.BackgroundTransparency = 1
	SectionFrame.AutomaticSize = Enum.AutomaticSize.Y
	SectionFrame.Parent = parent

	local Layout = Instance.new("UIListLayout")
	Layout.Padding = UDim.new(0, 8)
	Layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	Layout.Parent = SectionFrame

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, 0, 0, 30)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = title
	TitleLabel.TextColor3 = Color3.fromRGB(0, 150, 255)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 20
	TitleLabel.Parent = SectionFrame

	-- ===== Paragraph inside Section =====
	function Section:Paragraph(title, text)
		return CreateParagraph(SectionFrame, title, text)
	end

	return Section
end

--// CREATE WINDOW
function KazeUI:CreateWindow(config)
	config = config or {}

	-- Main Config
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = FormatImage(config.Icon or "6031763447")

	-- Open Button Config (ENFORCED to 60x60 for mobile playability)
	local OpenIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")
	local MiniButtonSize = UDim2.fromOffset(60, 60)

	local Callback = config.Callback

	-- Variables for responsive target
	local windowTargetSize = UDim2.new(0.88, 0, 0.80, 0)
	local minPixelWidth = 540
	local minPixelHeight = 360

	--// Main Window (initially set to target; UpdateWindowLayout will recalc)
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = windowTargetSize
	Window.Position = UDim2.new(0.5, 0, 0.5, 0)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	Window.BorderSizePixel = 0
	Window.Parent = ScreenGui
	Window.ClipsDescendants = true
	Window.ZIndex = 1000
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 12)

	local WindowStroke = Instance.new("UIStroke")
	WindowStroke.Color = Color3.fromRGB(0, 160, 255)
	WindowStroke.Thickness = 3 -- neon thickness slightly increased
	WindowStroke.Parent = Window
	WindowStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

	spawn(function()
		while Window.Parent do
			local t = TweenService:Create(WindowStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	-- Responsive layout computation
	local function UpdateWindowLayout()
		local vs = workspace.CurrentCamera.ViewportSize
		-- Determine widthScale based on viewport width (breakpoints)
		local widthScale
		if vs.X < 800 then
			widthScale = 0.95
		elseif vs.X < 1200 then
			widthScale = 0.92
		else
			widthScale = 0.88
		end
		-- Determine heightScale based on viewport height
		local heightScale
		if vs.Y < 600 then
			heightScale = 0.92
		elseif vs.Y < 900 then
			heightScale = 0.86
		else
			heightScale = 0.80
		end

		-- Ensure minimum pixel sizes (clamp scales so result >= min pixels)
		local targetPixelW = math.max(minPixelWidth, vs.X * widthScale)
		local targetPixelH = math.max(minPixelHeight, vs.Y * heightScale)
		-- Convert back to scale relative to viewport to avoid mixing scale+offset in size
		local finalScaleX = targetPixelW / vs.X
		local finalScaleY = targetPixelH / vs.Y

		windowTargetSize = UDim2.new(finalScaleX, 0, finalScaleY, 0)

		-- If window currently visible and not animating, update size/position immediately
		if Window and Window.Parent and Window.Visible then
			Window.Size = windowTargetSize
			Window.Position = UDim2.new(0.5, 0, 0.5, 0)
		end
	end

	-- Run once and on viewport changes
	UpdateWindowLayout()
	workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateWindowLayout)

	--// Top Bar (taller)
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 64)
	TopBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	TopBar.BorderSizePixel = 0
	TopBar.Parent = Window
	TopBar.ZIndex = 1001
	Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 12)
	MakeDraggable(TopBar, Window)

	-- Traffic light (macOS-style) controls moved to RIGHT side
	local TrafficFrame = Instance.new("Frame")
	TrafficFrame.Name = "TrafficFrame"
	TrafficFrame.Size = UDim2.fromOffset(70, 28)
	-- anchor to right so it won't be under Roblox topbar; positioned inside topbar's right edge
	TrafficFrame.AnchorPoint = Vector2.new(1, 0)
	TrafficFrame.Position = UDim2.new(1, -12, 0, 18)
	TrafficFrame.BackgroundTransparency = 1
	TrafficFrame.Parent = TopBar
	TrafficFrame.ZIndex = 1010

	local function makeLight(name, color, xOffset)
		local btn = Instance.new("TextButton")
		btn.Name = name
		btn.Size = UDim2.fromOffset(14, 14)
		btn.Position = UDim2.fromOffset(xOffset, 7)
		btn.BackgroundColor3 = color
		btn.BorderSizePixel = 0
		btn.AutoButtonColor = false
		btn.Text = ""
		btn.Parent = TrafficFrame
		btn.ZIndex = 1011
		local corner = Instance.new("UICorner", btn)
		corner.CornerRadius = UDim.new(1, 0)
		local s = Instance.new("UIStroke", btn)
		s.Color = Color3.fromRGB(20,20,20)
		s.Thickness = 1
		return btn
	end

	local RedLight = makeLight("RedLight", Color3.fromRGB(255, 95, 86), 44) -- close
	local YellowLight = makeLight("YellowLight", Color3.fromRGB(255, 196, 0), 22) -- minimize
	local GreenLight = makeLight("GreenLight", Color3.fromRGB(88, 214, 141), 0) -- placeholder

	-- Icon (kept left)
	local Icon = Instance.new("ImageLabel")
	Icon.Size = UDim2.fromOffset(32, 32)
	Icon.Position = UDim2.fromOffset(14, 16)
	Icon.BackgroundTransparency = 1
	Icon.Image = MainIcon
	Icon.Parent = TopBar
	Instance.new("UICorner", Icon).CornerRadius = UDim.new(1, 0)

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, -220, 0, 22)
	TitleLabel.Position = UDim2.fromOffset(58, 10)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(235, 235, 235)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 18
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = TopBar

	local SubLabel = Instance.new("TextLabel")
	SubLabel.Size = UDim2.new(1, -220, 0, 18)
	SubLabel.Position = UDim2.fromOffset(58, 32)
	SubLabel.BackgroundTransparency = 1
	SubLabel.Text = Author .. " | v" .. Version
	SubLabel.TextColor3 = Color3.fromRGB(160, 160, 160)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 13
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.Parent = TopBar

	--// Content + Sidebar + Pages
	local Content = Instance.new("Frame")
	Content.Position = UDim2.fromOffset(0, 64)
	Content.Size = UDim2.new(1, 0, 1, -64)
	Content.BackgroundTransparency = 1
	Content.Parent = Window

	-- Sidebar (tabs)
	local Sidebar = Instance.new("Frame")
	Sidebar.Name = "Sidebar"
	Sidebar.Size = UDim2.new(0, 260, 1, 0)
	Sidebar.Position = UDim2.new(0, 0, 0, 0)
	Sidebar.BackgroundTransparency = 1
	Sidebar.Parent = Content
	Sidebar.ZIndex = 1005

	local SidebarInner = Instance.new("Frame")
	SidebarInner.Size = UDim2.new(1, -24, 1, -40)
	SidebarInner.Position = UDim2.fromOffset(12, 12)
	SidebarInner.BackgroundColor3 = Color3.fromRGB(16, 16, 20)
	SidebarInner.BorderSizePixel = 0
	SidebarInner.Parent = Sidebar
	Instance.new("UICorner", SidebarInner).CornerRadius = UDim.new(0, 10)

	local TabsList = Instance.new("UIListLayout")
	TabsList.Parent = SidebarInner
	TabsList.Padding = UDim.new(0, 12)
	TabsList.SortOrder = Enum.SortOrder.LayoutOrder

	-- Pages container (rest of content)
	local PagesContainer = Instance.new("Frame")
	PagesContainer.Name = "PagesContainer"
	PagesContainer.Size = UDim2.new(1, -260, 1, 0)
	PagesContainer.Position = UDim2.new(0, 260, 0, 0)
	PagesContainer.BackgroundTransparency = 1
	PagesContainer.Parent = Content
	PagesContainer.ZIndex = 1002

	-- Manage tabs state
	local tabs = {}
	local activeTabButton = nil
	local activePage = nil

	-- Helper: set active tab
	local function SetActiveTab(tabButton, page)
		-- deactivate old
		if activeTabButton and activeTabButton ~= tabButton then
			activeTabButton.BackgroundTransparency = 1
			activeTabButton.TextColor3 = Color3.fromRGB(200, 200, 200)
			local leftIndicator = activeTabButton:FindFirstChild("LeftIndicator")
			if leftIndicator then leftIndicator.Visible = false end
		end
		-- hide old page
		if activePage and activePage ~= page then
			activePage.Visible = false
		end

		-- activate new
		activeTabButton = tabButton
		activePage = page
		activeTabButton.BackgroundTransparency = 0
		activeTabButton.BackgroundColor3 = Color3.fromRGB(22,22,26)
		activeTabButton.TextColor3 = Color3.fromRGB(255,255,255)
		local leftIndicator = activeTabButton:FindFirstChild("LeftIndicator")
		if leftIndicator then leftIndicator.Visible = true end
		page.Visible = true
	end

	-- API: CreateTab
	local function CreateTab(name)
		local Tab = {}

		-- Page
		Tab.Page = Instance.new("Frame")
		Tab.Page.Name = name .. "_Page"
		Tab.Page.Size = UDim2.new(1, 0, 1, 0)
		Tab.Page.BackgroundTransparency = 1
		Tab.Page.Visible = false
		Tab.Page.Parent = PagesContainer

		local Layout = Instance.new("UIListLayout")
		Layout.Padding = UDim.new(0, 8)
		Layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		Layout.Parent = Tab.Page

		-- Create button in sidebar
		local Btn = Instance.new("TextButton")
		Btn.Name = name .. "_TabButton"
		Btn.Size = UDim2.new(1, -12, 0, 44)
		Btn.BackgroundTransparency = 1
		Btn.Text = name
		Btn.TextColor3 = Color3.fromRGB(200, 200, 200)
		Btn.Font = Enum.Font.Gotham
		Btn.TextSize = 16
		Btn.TextXAlignment = Enum.TextXAlignment.Left
		Btn.Parent = SidebarInner
		Btn.AutoButtonColor = true
		Btn.LayoutOrder = #tabs + 1
		Btn.ZIndex = 1006
		-- left indicator
		local LeftIndicator = Instance.new("Frame")
		LeftIndicator.Name = "LeftIndicator"
		LeftIndicator.Size = UDim2.new(0, 4, 1, 0)
		LeftIndicator.Position = UDim2.new(0, 0, 0, 0)
		LeftIndicator.BackgroundColor3 = Color3.fromRGB(0, 160, 255)
		LeftIndicator.Visible = false
		LeftIndicator.Parent = Btn
		Instance.new("UICorner", LeftIndicator).CornerRadius = UDim.new(0, 4)

		-- small icon placeholder on left of text (optional)
		local IconHolder = Instance.new("Frame")
		IconHolder.Size = UDim2.new(0, 36, 0, 36)
		IconHolder.Position = UDim2.new(0, 8, 0, 4)
		IconHolder.BackgroundTransparency = 1
		IconHolder.Parent = Btn
		local iconImg = Instance.new("ImageLabel")
		iconImg.Size = UDim2.fromOffset(20,20)
		iconImg.Position = UDim2.fromOffset(8,12)
		iconImg.BackgroundTransparency = 1
		iconImg.Image = "" -- leave blank; user can set later via Tab.Page or returned handle
		iconImg.Parent = Btn

		-- adjust text position to avoid icon overlap
		Btn.TextXAlignment = Enum.TextXAlignment.Left
		Btn.TextScaled = false
		Btn.TextWrapped = false
		Btn.Padding = Instance.new("UIPadding", Btn)
		Btn.Padding.PaddingLeft = UDim.new(0, 56)

		Btn.MouseButton1Click:Connect(function()
			SetActiveTab(Btn, Tab.Page)
		end)

		-- ===== Paragraph directly on Tab =====
		function Tab:Paragraph(title, text)
			return CreateParagraph(Tab.Page, title, text)
		end

		-- ===== Section inside Tab =====
		function Tab:Section(title)
			return CreateSection(Tab.Page, title)
		end

		-- store
		table.insert(tabs, {name = name, button = Btn, page = Tab.Page})

		-- if this is first tab, activate it
		if #tabs == 1 then
			SetActiveTab(Btn, Tab.Page)
		end

		return Tab
	end

	--// MINI BUTTON (60x60 Square ImageButton)
	local MiniButton = Instance.new("ImageButton")
	MiniButton.Name = "MiniButton"
	MiniButton.Size = MiniButtonSize -- enforced exact 60x60
	MiniButton.Position = UDim2.fromScale(0.1, 0.1)
	MiniButton.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	MiniButton.BorderSizePixel = 0
	MiniButton.Visible = false
	MiniButton.Parent = ScreenGui -- parent directly so it stays above Window when minimized
	MiniButton.ZIndex = 1100 -- ensure it's on top
	MiniButton.ScaleType = Enum.ScaleType.Slice
	MiniButton.SliceCenter = Rect.new(4,4,60,60)

	local miniUICorner = Instance.new("UICorner")
	miniUICorner.CornerRadius = UDim.new(0, 12)
	miniUICorner.Parent = MiniButton

	local miniPadding = Instance.new("UIPadding")
	miniPadding.PaddingTop = UDim.new(0, 4)
	miniPadding.PaddingBottom = UDim.new(0, 4)
	miniPadding.PaddingLeft = UDim.new(0, 4)
	miniPadding.PaddingRight = UDim.new(0, 4)
	miniPadding.Parent = MiniButton

	local MiniIcon = Instance.new("ImageLabel")
	-- Fill the padded area and center the icon
	MiniIcon.Size = UDim2.fromScale(1, 1)
	MiniIcon.Position = UDim2.fromScale(0.5, 0.5)
	MiniIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	MiniIcon.BackgroundTransparency = 1
	MiniIcon.Image = OpenIcon
	MiniIcon.Parent = MiniButton
	MiniIcon.ZIndex = 1101

	local MiniStroke = Instance.new("UIStroke")
	MiniStroke.Color = Color3.fromRGB(0, 160, 255)
	MiniStroke.Thickness = 2.5 -- neon thickness
	-- ensure the glow stays on the outside edge
	MiniStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	MiniStroke.Parent = MiniButton
	MiniStroke.LineJoinMode = Enum.LineJoinMode.Bevel

	spawn(function()
		while MiniButton.Parent do
			local t = TweenService:Create(MiniStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	-- Make draggable
	MakeDraggable(TopBar, Window)
	MakeDraggable(MiniButton, MiniButton)

	-- Minimize: hide window, show mini button
	local function DoMinimize()
		Window.Visible = false
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(MiniButton, TweenInfo.new(0.28, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = MiniButtonSize}):Play()
	end

	-- Restore from mini button
	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.new(0, 0, 0, 0)
		-- animate back to the computed target size
		TweenService:Create(Window, TweenInfo.new(0.32, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = windowTargetSize}):Play()
	end)

	-- Close confirmation
	local function ShowCloseConfirm()
		TrafficFrame.Active = false
		local Overlay = Instance.new("Frame")
		Overlay.Size = UDim2.new(1, 0, 1, 0)
		Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		Overlay.BackgroundTransparency = 0.6
		Overlay.ZIndex = 1020
		Overlay.Parent = Window

		local ConfirmWindow = Instance.new("Frame")
		ConfirmWindow.Size = UDim2.fromOffset(380, 160)
		ConfirmWindow.AnchorPoint = Vector2.new(0.5, 0.5)
		ConfirmWindow.Position = UDim2.fromScale(0.5, 0.5)
		ConfirmWindow.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		ConfirmWindow.ZIndex = 1021
		ConfirmWindow.Parent = Overlay
		Instance.new("UICorner", ConfirmWindow).CornerRadius = UDim.new(0, 12)

		local ConfirmText = Instance.new("TextLabel")
		ConfirmText.Size = UDim2.new(1, -32, 0, 54)
		ConfirmText.Position = UDim2.fromOffset(16, 18)
		ConfirmText.BackgroundTransparency = 1
		ConfirmText.Text = "Are you sure you want to close the UI?"
		ConfirmText.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmText.Font = Enum.Font.GothamBold
		ConfirmText.TextSize = 18
		ConfirmText.TextWrapped = true
		ConfirmText.ZIndex = 1022
		ConfirmText.Parent = ConfirmWindow

		local ButtonsFrame = Instance.new("Frame")
		ButtonsFrame.Size = UDim2.new(1, 0, 0, 44)
		ButtonsFrame.Position = UDim2.new(0, 0, 1, -22)
		ButtonsFrame.AnchorPoint = Vector2.new(0, 1)
		ButtonsFrame.BackgroundTransparency = 1
		ButtonsFrame.ZIndex = 1022
		ButtonsFrame.Parent = ConfirmWindow

		local layout = Instance.new("UIListLayout")
		layout.Parent = ButtonsFrame
		layout.FillDirection = Enum.FillDirection.Horizontal
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		layout.Padding = UDim.new(0, 18)

		local ConfirmBtn = Instance.new("TextButton")
		ConfirmBtn.Size = UDim2.new(0, 140, 0, 38)
		ConfirmBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
		ConfirmBtn.Text = "Confirm"
		ConfirmBtn.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmBtn.Font = Enum.Font.GothamBold
		ConfirmBtn.TextSize = 16
		ConfirmBtn.ZIndex = 1023
		ConfirmBtn.Parent = ButtonsFrame
		Instance.new("UICorner", ConfirmBtn).CornerRadius = UDim.new(0, 8)

		local CancelBtn = Instance.new("TextButton")
		CancelBtn.Size = UDim2.new(0, 140, 0, 38)
		CancelBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
		CancelBtn.Text = "Cancel"
		CancelBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
		CancelBtn.Font = Enum.Font.GothamBold
		CancelBtn.TextSize = 16
		CancelBtn.ZIndex = 1023
		CancelBtn.Parent = ButtonsFrame
		Instance.new("UICorner", CancelBtn).CornerRadius = UDim.new(0, 8)

		ConfirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			TrafficFrame.Active = true
		end)
	end

	-- Traffic light behaviors
	local accentToggled = false
	GreenLight.MouseButton1Click:Connect(function()
		-- placeholder: toggle accent color between default and green tint
		accentToggled = not accentToggled
		if accentToggled then
			WindowStroke.Color = Color3.fromRGB(88, 214, 141) -- green accent
		else
			WindowStroke.Color = Color3.fromRGB(0, 160, 255) -- default blue accent
		end
	end)

	YellowLight.MouseButton1Click:Connect(function()
		DoMinimize()
	end)

	RedLight.MouseButton1Click:Connect(function()
		ShowCloseConfirm()
	end)

	if typeof(Callback) == "function" then
		pcall(Callback)
	end

	-- Return API table for the created window (so user can call Window:CreateTab(...))
	local api = {
		Window = Window,
		Content = Content,
		Icon = Icon,
		MiniButton = MiniButton,
		CreateTab = CreateTab, -- method-style usage: local t = Window:CreateTab("Main")
		-- convenience: expose PagesContainer & Sidebar for custom modifications
		PagesContainer = PagesContainer,
		Sidebar = SidebarInner,
	}

	-- Set metatable so user can call api:CreateTab(...) as method
	setmetatable(api, {
		__index = api,
		__call = function(self, ...)
			return CreateTab(...)
		end
	})

	return api
end

return KazeUI
