-- Unified KazeUI (responsive + Tabs/Sections/Paragraphs integrated)
-- - Responsive window that stays above Core UI
-- - Traffic lights on right, draggable topbar
-- - Tabs (scrollable) + Sections + Paragraphs (auto-sizing)
-- - Mini/open square button (draggable) with stable position

local KazeUI = {}
KazeUI.__index = KazeUI

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local TextService = game:GetService("TextService")
local LP = Players.LocalPlayer

-- ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.DisplayOrder = 9999
ScreenGui.IgnoreGuiInset = true
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

-- UIScale
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui
local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	if size.X < 600 then
		UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
	else
		UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
	end
end
UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

-- Helpers
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id)
	local clean = string.gsub(id, "%D", "")
	if clean == "" then return "" end
	return "rbxassetid://" .. clean
end

local function MakeDraggable(dragPart, targetPart)
	local dragging = false
	local dragInput, dragStart, startPos
	local function update(input)
		if not dragStart or not startPos then return end
		local delta = input.Position - dragStart
		targetPart.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end
	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					dragInput = nil
				end
			end)
		end
	end)
	dragPart.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

-- Neon loop helper (safe)
local function StartNeonLoop(target)
	if not target then return end
	spawn(function()
		while target and target.Parent do
			local propName
			if pcall(function() return target.Color end) then
				propName = "Color"
			elseif pcall(function() return target.BackgroundColor3 end) then
				propName = "BackgroundColor3"
			end
			if not propName then break end
			local tweenInfo = TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
			local ok, tween = pcall(function()
				return TweenService:Create(target, tweenInfo, { [propName] = Color3.fromRGB(0, 255, 255) })
			end)
			if ok and tween then tween:Play() end
			break
		end
	end)
end

-- Paragraph creation (auto-sizing, neon glow accent)
local function CreateParagraph(parentFrame, strokeColor, title, body)
	title = tostring(title or "")
	body = tostring(body or "")
	local measuredWidth = 520
	if parentFrame and parentFrame.AbsoluteSize and parentFrame.AbsoluteSize.X > 0 then
		measuredWidth = math.max(200, parentFrame.AbsoluteSize.X * 0.95)
	end
	local titleHeight = 0
	if title ~= " " and title ~= "" then
		local ts = TextService:GetTextSize(title, 16, Enum.Font.GothamBold, Vector2.new(measuredWidth - 32, 2000))
		titleHeight = math.max(20, math.ceil(ts.Y))
	end
	local bodySize = TextService:GetTextSize(body, 14, Enum.Font.Gotham, Vector2.new(measuredWidth - 32, 4000))
	local bodyHeight = math.ceil(bodySize.Y)
	local totalHeight = 10 + titleHeight + (titleHeight>0 and 6 or 0) + bodyHeight + 10
	local wrapper = Instance.new("Frame")
	wrapper.Name = "ParagraphWrapper"
	wrapper.Size = UDim2.new(1, 0, 0, totalHeight + 12)
	wrapper.BackgroundTransparency = 1
	wrapper.Parent = parentFrame
	wrapper.AutomaticSize = Enum.AutomaticSize.Y

	local paraFrame = Instance.new("Frame")
	paraFrame.Name = "Paragraph"
	paraFrame.AnchorPoint = Vector2.new(0.5, 0)
	paraFrame.Position = UDim2.new(0.5, 0, 0, 6)
	paraFrame.Size = UDim2.new(0.95, 0, 0, totalHeight)
	paraFrame.BackgroundColor3 = Color3.fromRGB(24,24,28)
	paraFrame.BorderSizePixel = 0
	Instance.new("UICorner", paraFrame).CornerRadius = UDim.new(0, 8)
	paraFrame.Parent = wrapper

	local glow = Instance.new("Frame")
	glow.Name = "ParagraphGlow"
	glow.AnchorPoint = Vector2.new(0.5, 0)
	glow.Position = UDim2.new(0.5, 0, 0, 4)
	glow.Size = UDim2.new(0.96, 0, 0, totalHeight + 10)
	glow.BackgroundTransparency = 0.96
	glow.BackgroundColor3 = strokeColor or Color3.fromRGB(0,160,255)
	Instance.new("UICorner", glow).CornerRadius = UDim.new(0, 10)
	glow.Parent = wrapper
	StartNeonLoop(glow)

	local paraStroke = Instance.new("UIStroke", paraFrame)
	paraStroke.Thickness = 2
	paraStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	paraStroke.Color = strokeColor or Color3.fromRGB(0,160,255)
	StartNeonLoop(paraStroke)

	local inner = Instance.new("Frame", paraFrame)
	inner.Size = UDim2.new(1, -20, 1, -20)
	inner.Position = UDim2.fromOffset(10,10)
	inner.BackgroundTransparency = 1

	if title ~= " " and title ~= "" then
		local ptitleLabel = Instance.new("TextLabel", inner)
		ptitleLabel.Name = "ParagraphTitle"
		ptitleLabel.Size = UDim2.new(1,0,0,titleHeight)
		ptitleLabel.Position = UDim2.fromOffset(0,0)
		ptitleLabel.BackgroundTransparency = 1
		ptitleLabel.Text = title
		ptitleLabel.TextColor3 = Color3.fromRGB(255,255,255)
		ptitleLabel.Font = Enum.Font.GothamBold
		ptitleLabel.TextSize = 16
		ptitleLabel.TextXAlignment = Enum.TextXAlignment.Left
		ptitleLabel.TextWrapped = true
	end

	local bodyLabel = Instance.new("TextLabel", inner)
	bodyLabel.Name = "ParagraphBody"
	bodyLabel.Size = UDim2.new(1,0,0,bodyHeight)
	bodyLabel.Position = UDim2.fromOffset(0, titleHeight + (titleHeight>0 and 6 or 0))
	bodyLabel.BackgroundTransparency = 1
	bodyLabel.Text = body
	bodyLabel.TextColor3 = Color3.fromRGB(255,255,255)
	bodyLabel.Font = Enum.Font.Gotham
	bodyLabel.TextSize = 14
	bodyLabel.TextWrapped = true
	bodyLabel.TextXAlignment = Enum.TextXAlignment.Left
	bodyLabel.TextYAlignment = Enum.TextYAlignment.Top

	local paraAPI = {
		Wrapper = wrapper,
		Frame = paraFrame,
		BodyLabel = bodyLabel,
		SetText = function(self, newText)
			newText = tostring(newText or " ")
			bodyLabel.Text = newText
			task.defer(function()
				local w = measuredWidth
				if parentFrame and parentFrame.AbsoluteSize and parentFrame.AbsoluteSize.X > 0 then
					w = math.max(200, parentFrame.AbsoluteSize.X * 0.95)
				end
				local newTitleH = 0
				if title ~= " " and title ~= "" then
					local ts2 = TextService:GetTextSize(title, 16, Enum.Font.GothamBold, Vector2.new(w - 32, 2000))
					newTitleH = math.max(20, math.ceil(ts2.Y))
				end
				local newBodySize = TextService:GetTextSize(newText, 14, Enum.Font.Gotham, Vector2.new(w - 32, 4000))
				local newBodyH = math.ceil(newBodySize.Y)
				local newTotal = 10 + newTitleH + (newTitleH>0 and 6 or 0) + newBodyH + 10
				paraFrame.Size = UDim2.new(0.95, 0, 0, newTotal)
				glow.Size = UDim2.new(0.96, 0, 0, newTotal + 10)
				wrapper.Size = UDim2.new(1, 0, 0, newTotal + 12)
				if paraFrame:FindFirstChild("ParagraphTitle") then
					paraFrame.ParagraphTitle.Size = UDim2.new(1, 0, 0, newTitleH)
				end
				bodyLabel.Size = UDim2.new(1, 0, 0, newBodyH)
			end)
		end,
	}
	return paraAPI
end

-- CreateWindow (main)
function KazeUI:CreateWindow(config)
	config = config or {}
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = FormatImage(config.Icon or "6031763447")
	local OpenIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")
	local MiniButtonSize = UDim2.fromOffset(60, 60)
	local Callback = config.Callback

	-- Responsive target calculation
	local windowTargetSize = UDim2.new(0.88, 0, 0.80, 0)
	local minPixelWidth, minPixelHeight = 540, 360
	local function UpdateWindowLayout(Window)
		local vs = workspace.CurrentCamera.ViewportSize
		local wScale = (vs.X < 800) and 0.95 or ((vs.X < 1200) and 0.92 or 0.88)
		local hScale = (vs.Y < 600) and 0.92 or ((vs.Y < 900) and 0.86 or 0.80)
		local targetPixelW = math.max(minPixelWidth, vs.X * wScale)
		local targetPixelH = math.max(minPixelHeight, vs.Y * hScale)
		local finalScaleX = targetPixelW / vs.X
		local finalScaleY = targetPixelH / vs.Y
		windowTargetSize = UDim2.new(finalScaleX, 0, finalScaleY, 0)
		if Window and Window.Parent and Window.Visible then
			Window.Size = windowTargetSize
			Window.Position = UDim2.new(0.5, 0, 0.5, 0)
		end
	end

	-- Main Window
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = windowTargetSize
	Window.Position = UDim2.new(0.5, 0, 0.5, 0)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Color3.fromRGB(20,20,25)
	Window.BorderSizePixel = 0
	Window.Parent = ScreenGui
	Window.ClipsDescendants = true
	Window.ZIndex = 1000
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 12)

	local WindowStroke = Instance.new("UIStroke")
	WindowStroke.Color = Color3.fromRGB(0,160,255)
	WindowStroke.Thickness = 3
	WindowStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	WindowStroke.Parent = Window
	StartNeonLoop(WindowStroke)

	-- Update layout on viewport changes
	UpdateWindowLayout(Window)
	workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(function() UpdateWindowLayout(Window) end)

	-- TopBar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1,0,0,64)
	TopBar.BackgroundColor3 = Color3.fromRGB(15,15,20)
	TopBar.BorderSizePixel = 0
	TopBar.Parent = Window
	TopBar.ZIndex = 1001
	Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 12)
	MakeDraggable(TopBar, Window)

	-- Avatar + Titles
	local Avatar = Instance.new("ImageLabel")
	Avatar.Name = "Avatar"
	Avatar.Size = UDim2.fromOffset(36,36)
	Avatar.Position = UDim2.fromOffset(12,14)
	Avatar.BackgroundColor3 = Color3.fromRGB(30,30,35)
	Avatar.Image = MainIcon
	Avatar.Parent = TopBar
	Instance.new("UICorner", Avatar).CornerRadius = UDim.new(1,0)
	local avatarStroke = Instance.new("UIStroke", Avatar)
	avatarStroke.Color = Color3.fromRGB(0,140,200)
	avatarStroke.Thickness = 1

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, -220, 0, 22)
	TitleLabel.Position = UDim2.fromOffset(56,12)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(235,235,235)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 16
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = TopBar

	local SubLabel = Instance.new("TextLabel")
	SubLabel.Size = UDim2.new(1, -220, 0, 18)
	SubLabel.Position = UDim2.fromOffset(56,34)
	SubLabel.BackgroundTransparency = 1
	SubLabel.Text = Author .. " | v" .. Version
	SubLabel.TextColor3 = Color3.fromRGB(160,160,160)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 13
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.Parent = TopBar

	-- Top divider highlight
	local TopDivider = Instance.new("Frame")
	TopDivider.Name = "TopDivider"
	TopDivider.Size = UDim2.new(1,0,0,2)
	TopDivider.Position = UDim2.new(0,0,1,-2)
	TopDivider.BackgroundColor3 = WindowStroke.Color
	TopDivider.BorderSizePixel = 0
	TopDivider.ZIndex = 5
	TopDivider.Parent = TopBar
	Instance.new("UICorner", TopDivider).CornerRadius = UDim.new(0,6)
	local topDivStroke = Instance.new("UIStroke", TopDivider)
	topDivStroke.Color = WindowStroke.Color
	topDivStroke.Thickness = WindowStroke.Thickness
	topDivStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	StartNeonLoop(topDivStroke)

	-- Traffic lights (right)
	local function createCircle(name, offsetX, color)
		local btn = Instance.new("TextButton")
		btn.Name = name
		btn.Size = UDim2.fromOffset(16,16)
		btn.Position = UDim2.new(1, offsetX, 0, 16)
		btn.BackgroundColor3 = color
		btn.BorderSizePixel = 0
		btn.Text = ""
		btn.Parent = TopBar
		Instance.new("UICorner", btn).CornerRadius = UDim.new(1,0)
		local s = Instance.new("UIStroke", btn)
		s.Color = Color3.fromRGB(20,20,20)
		s.Thickness = 1
		return btn
	end
	local BtnGreen = createCircle("BtnGreen", -70, Color3.fromRGB(88,214,141))
	local BtnYellow = createCircle("BtnYellow", -48, Color3.fromRGB(255,196,0))
	local BtnRed = createCircle("BtnRed", -26, Color3.fromRGB(255,95,86))

	-- Content + Sidebar + Pages (Tabs)
	local Content = Instance.new("Frame")
	Content.Position = UDim2.fromOffset(0,64)
	Content.Size = UDim2.new(1,0,1,-64)
	Content.BackgroundTransparency = 1
	Content.Parent = Window

	-- Sidebar
	local SideBar = Instance.new("Frame")
	SideBar.Name = "SideBar"
	SideBar.Size = UDim2.new(0,180,1,0)
	SideBar.Position = UDim2.new(0,0,0,0)
	SideBar.BackgroundColor3 = Color3.fromRGB(20,20,25)
	SideBar.BorderSizePixel = 0
	SideBar.Parent = Content
	Instance.new("UICorner", SideBar).CornerRadius = UDim.new(0,14)

	-- Vertical divider (neon)
	local VertDivider = Instance.new("Frame")
	VertDivider.Name = "VertDivider"
	VertDivider.Size = UDim2.new(0,2,1,0)
	VertDivider.Position = UDim2.new(0,180,0,0)
	VertDivider.BackgroundColor3 = WindowStroke.Color
	VertDivider.BorderSizePixel = 0
	VertDivider.Parent = Content
	Instance.new("UICorner", VertDivider).CornerRadius = UDim.new(0,6)
	local vertDivStroke = Instance.new("UIStroke", VertDivider)
	vertDivStroke.Color = WindowStroke.Color
	vertDivStroke.Thickness = WindowStroke.Thickness
	vertDivStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	StartNeonLoop(vertDivStroke)

	-- Pages area
	local Pages = Instance.new("Frame")
	Pages.Name = "Pages"
	Pages.Position = UDim2.new(0,182,0,0)
	Pages.Size = UDim2.new(1, -182, 1, 0)
	Pages.BackgroundColor3 = Color3.fromRGB(18,18,23)
	Pages.BorderSizePixel = 0
	Pages.Parent = Content
	Instance.new("UICorner", Pages).CornerRadius = UDim.new(0,12)

	-- Tabs scroller (sidebar)
	local TabsScroller = Instance.new("ScrollingFrame")
	TabsScroller.Name = "TabsScroller"
	TabsScroller.Parent = SideBar
	TabsScroller.Position = UDim2.fromOffset(8,8)
	TabsScroller.Size = UDim2.new(1, -16, 1, -16)
	TabsScroller.BackgroundTransparency = 1
	TabsScroller.ScrollBarThickness = 6
	TabsScroller.CanvasSize = UDim2.new(0, 0, 0, 0)
	TabsScroller.AutomaticCanvasSize = Enum.AutomaticSize.Y
	TabsScroller.ScrollBarImageColor3 = Color3.fromRGB(40,40,45)

	local TabsList = Instance.new("Frame")
	TabsList.Name = "TabsList"
	TabsList.BackgroundTransparency = 1
	TabsList.Size = UDim2.new(1, 0, 0, 0)
	TabsList.Parent = TabsScroller
	TabsList.AutomaticSize = Enum.AutomaticSize.Y

	local tabsLayout = Instance.new("UIListLayout", TabsList)
	tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabsLayout.Padding = UDim.new(0,8)

	-- Tab storage
	local createdTabs = {}

	-- Appearance constants
	local TAB_BUTTON_HEIGHT = 44
	local TAB_CORNER_RADIUS = 6
	local TAB_BG = Color3.fromRGB(24,24,28)
	local TAB_BG_ACTIVE = Color3.fromRGB(32,32,36)
	local TAB_TEXT_COLOR = Color3.fromRGB(240,240,240)
	local TAB_TEXT_INACTIVE = Color3.fromRGB(200,200,200)

	-- Window API table to return
	local Win = {
		Window = Window,
		Content = Content,
		Icon = Avatar,
		MiniButton = nil, -- assigned later
		SideBar = SideBar,
		_Pages = Pages,
		_TabsList = TabsList,
		_Tabs = createdTabs,
		_Stroke = WindowStroke,
		_TargetSize = function() return windowTargetSize end,
	}

	-- CreateTab implementation (compatible with your Tabs file)
	function Win:CreateTab(name, iconId)
		name = tostring(name or "Tab")
		local formattedIcon = FormatImage(iconId or "")

		local btn = Instance.new("TextButton")
		btn.Name = "TabButton_" .. name
		btn.Size = UDim2.new(1, -16, 0, TAB_BUTTON_HEIGHT)
		btn.BackgroundColor3 = TAB_BG
		btn.BorderSizePixel = 0
		btn.Text = " "
		btn.AutoButtonColor = false
		btn.Parent = TabsList
		Instance.new("UICorner", btn).CornerRadius = UDim.new(0, TAB_CORNER_RADIUS)
		btn.LayoutOrder = #self._Tabs + 1

		local leftIndicator = Instance.new("Frame", btn)
		leftIndicator.Name = "LeftIndicator"
		leftIndicator.Size = UDim2.new(0,4,1,0)
		leftIndicator.Position = UDim2.new(0,0,0,0)
		leftIndicator.BackgroundColor3 = self._Stroke.Color
		leftIndicator.BorderSizePixel = 0
		leftIndicator.Visible = false
		Instance.new("UICorner", leftIndicator).CornerRadius = UDim.new(0,6)

		local iconLabel = Instance.new("ImageLabel", btn)
		iconLabel.Name = "Icon"
		iconLabel.Size = UDim2.fromOffset(28,28)
		iconLabel.Position = UDim2.new(0,10,0.5,-14)
		iconLabel.BackgroundTransparency = 1
		iconLabel.Image = formattedIcon
		Instance.new("UICorner", iconLabel).CornerRadius = UDim.new(1,0)

		local txt = Instance.new("TextLabel", btn)
		txt.Name = "Label"
		txt.Size = UDim2.new(1, -56, 1, 0)
		txt.Position = UDim2.fromOffset(48,0)
		txt.BackgroundTransparency = 1
		txt.Text = name
		txt.TextColor3 = TAB_TEXT_INACTIVE
		txt.Font = Enum.Font.Gotham
		txt.TextSize = 15
		txt.TextXAlignment = Enum.TextXAlignment.Left

		local page = Instance.new("Frame")
		page.Name = "Page_" .. name
		page.Size = UDim2.new(1,0,1,0)
		page.BackgroundTransparency = 1
		page.BorderSizePixel = 0
		page.Parent = self._Pages
		page.Visible = false

		local pageContent = Instance.new("Frame", page)
		pageContent.Name = "PageContent"
		pageContent.Size = UDim2.new(1, 0, 1, 0)
		pageContent.Position = UDim2.new(0,0,0,0)
		pageContent.BackgroundTransparency = 1
		pageContent.BorderSizePixel = 0
		local contentLayout = Instance.new("UIListLayout", pageContent)
		contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
		contentLayout.Padding = UDim.new(0,8)
		contentLayout.VerticalAlignment = Enum.VerticalAlignment.Top
		contentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

		local tabObj = {
			Button = btn,
			Indicator = leftIndicator,
			Label = txt,
			Icon = iconLabel,
			Page = page,
			PageContent = pageContent,
		}
		table.insert(self._Tabs, tabObj)

		-- activation function
		local function activate()
			for _, t in ipairs(self._Tabs) do
				if t.Button and t.Indicator and t.Page and t.Label then
					TweenService:Create(t.Button, TweenInfo.new(0.12), { BackgroundColor3 = TAB_BG }):Play()
					t.Indicator.Visible = false
					t.Page.Visible = false
					t.Label.TextColor3 = TAB_TEXT_INACTIVE
					t.Label.Font = Enum.Font.Gotham
				end
			end
			TweenService:Create(btn, TweenInfo.new(0.12), { BackgroundColor3 = TAB_BG_ACTIVE }):Play()
			leftIndicator.Visible = true
			page.Visible = true
			txt.TextColor3 = TAB_TEXT_COLOR
			txt.Font = Enum.Font.GothamBold
			page.Parent = self._Pages
		end

		-- hover behavior
		local hoverTweenInfo = TweenInfo.new(0.10, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local hoverBG = Color3.fromRGB(28,28,31)
		local leaveBG = TAB_BG
		btn.MouseEnter:Connect(function()
			if not leftIndicator.Visible then
				TweenService:Create(btn, hoverTweenInfo, { BackgroundColor3 = hoverBG }):Play()
				txt.TextColor3 = Color3.fromRGB(220,220,220)
			end
		end)
		btn.MouseLeave:Connect(function()
			if not leftIndicator.Visible then
				TweenService:Create(btn, hoverTweenInfo, { BackgroundColor3 = leaveBG }):Play()
				txt.TextColor3 = TAB_TEXT_INACTIVE
			end
		end)
		btn.MouseButton1Click:Connect(activate)

		if #self._Tabs == 1 then activate() end

		-- public tab API
		local public = {
			Button = btn,
			Page = page,
			_PageContent = pageContent,
			_Stroke = self._Stroke,
		}
		function public:Paragraph(ptitle, pbody)
			return CreateParagraph(self._PageContent, self._Stroke.Color, ptitle, pbody)
		end
		function public:Section(title)
			title = tostring(title or " ")
			local sectionFrame = Instance.new("Frame")
			sectionFrame.Name = "Section_" .. title
			sectionFrame.Size = UDim2.new(1, -24, 0, 0)
			sectionFrame.BackgroundTransparency = 1
			sectionFrame.BorderSizePixel = 0
			sectionFrame.Parent = self._PageContent
			sectionFrame.AutomaticSize = Enum.AutomaticSize.Y

			local sectionLayout = Instance.new("UIListLayout", sectionFrame)
			sectionLayout.SortOrder = Enum.SortOrder.LayoutOrder
			sectionLayout.Padding = UDim.new(0, 6)
			sectionLayout.VerticalAlignment = Enum.VerticalAlignment.Top
			sectionLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

			local titleLabel = Instance.new("TextLabel")
			titleLabel.Name = "SectionTitle"
			titleLabel.Size = UDim2.new(1, 0, 0, 36)
			titleLabel.BackgroundTransparency = 1
			titleLabel.Text = title
			titleLabel.TextColor3 = Color3.fromRGB(0,120,255)
			titleLabel.Font = Enum.Font.GothamBold
			titleLabel.TextSize = 22
			titleLabel.TextWrapped = true
			titleLabel.TextXAlignment = Enum.TextXAlignment.Center
			titleLabel.Parent = sectionFrame

			local sep = Instance.new("Frame")
			sep.Name = "SectionSeparator"
			sep.Size = UDim2.new(0.6, 0, 0, 2)
			sep.BackgroundColor3 = Color3.fromRGB(38,38,42)
			sep.BorderSizePixel = 0
			sep.Parent = sectionFrame
			Instance.new("UICorner", sep).CornerRadius = UDim.new(0,4)

			local sectionContent = Instance.new("Frame")
			sectionContent.Name = "SectionContent"
			sectionContent.Size = UDim2.new(1, 0, 0, 0)
			sectionContent.BackgroundTransparency = 1
			sectionContent.BorderSizePixel = 0
			sectionContent.Parent = sectionFrame
			sectionContent.AutomaticSize = Enum.AutomaticSize.Y

			local secLayout = Instance.new("UIListLayout", sectionContent)
			secLayout.SortOrder = Enum.SortOrder.LayoutOrder
			secLayout.Padding = UDim.new(0,8)
			secLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
			secLayout.VerticalAlignment = Enum.VerticalAlignment.Top

			local sectionPublic = {}
			sectionPublic.Frame = sectionFrame
			sectionPublic.TitleLabel = titleLabel

			function sectionPublic:AddLabel(text)
				local label = Instance.new("TextLabel")
				label.Size = UDim2.new(1, -40, 0, 24)
				label.BackgroundTransparency = 1
				label.Text = tostring(text or " ")
				label.TextColor3 = Color3.fromRGB(220,220,220)
				label.Font = Enum.Font.Gotham
				label.TextSize = 14
				label.TextXAlignment = Enum.TextXAlignment.Left
				label.Parent = sectionContent
				return label
			end

			function sectionPublic:AddParagraph(ptitle, pbody)
				return CreateParagraph(sectionContent, Win._Stroke.Color, ptitle, pbody)
			end

			return sectionPublic
		end

		return public
	end

	-- Mini/open square button (draggable) - make position stable by default
	local MiniButton = Instance.new("ImageButton")
	MiniButton.Name = "MiniButton"
	MiniButton.Size = MiniButtonSize
	-- default position: near top-left behind the topbar icons (adjustable)
	MiniButton.Position = UDim2.fromOffset(96, 18)
	MiniButton.BackgroundColor3 = Color3.fromRGB(20,20,25)
	MiniButton.BorderSizePixel = 0
	MiniButton.Visible = false
	MiniButton.Parent = ScreenGui
	MiniButton.ZIndex = 1100
	MiniButton.ScaleType = Enum.ScaleType.Slice
	MiniButton.SliceCenter = Rect.new(4,4,60,60)
	Instance.new("UICorner", MiniButton).CornerRadius = UDim.new(0,12)
	local miniPadding = Instance.new("UIPadding", MiniButton)
	miniPadding.PaddingTop = UDim.new(0,4); miniPadding.PaddingBottom = UDim.new(0,4)
	miniPadding.PaddingLeft = UDim.new(0,4); miniPadding.PaddingRight = UDim.new(0,4)

	local MiniIcon = Instance.new("ImageLabel")
	MiniIcon.Size = UDim2.fromScale(1,1)
	MiniIcon.Position = UDim2.fromScale(0.5,0.5)
	MiniIcon.AnchorPoint = Vector2.new(0.5,0.5)
	MiniIcon.BackgroundTransparency = 1
	MiniIcon.Image = OpenIcon
	MiniIcon.Parent = MiniButton
	MiniIcon.ZIndex = 1101

	local MiniStroke = Instance.new("UIStroke")
	MiniStroke.Color = WindowStroke.Color
	MiniStroke.Thickness = WindowStroke.Thickness
	MiniStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	MiniStroke.Parent = MiniButton
	StartNeonLoop(MiniStroke)

	MakeDraggable(TopBar, Window)
	MakeDraggable(MiniButton, MiniButton)
	Win.MiniButton = MiniButton

	-- Minimize behavior
	local function DoMinimize()
		Window.Visible = false
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0,0)
		TweenService:Create(MiniButton, TweenInfo.new(0.28, Enum.EasingStyle.Back, Enum.EasingDirection.Out), { Size = MiniButtonSize }):Play()
	end
	BtnYellow.MouseButton1Click:Connect(DoMinimize)

	-- Green toggles maximize/restore
	local toggledMax = false
	local lastSize, lastPos, lastAnchor = Window.Size, Window.Position, Window.AnchorPoint
	BtnGreen.MouseButton1Click:Connect(function()
		if not toggledMax then
			lastSize, lastPos, lastAnchor = Window.Size, Window.Position, Window.AnchorPoint
			toggledMax = true
			Window.AnchorPoint = Vector2.new(0.5,0.5)
			Window.Position = UDim2.new(0.5,0.5)
			TweenService:Create(Window, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), { Size = UDim2.new(0.96,0,0.94,0) }):Play()
		else
			toggledMax = false
			TweenService:Create(Window, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), { Size = lastSize, Position = lastPos }):Play()
			delay(0.25, function() Window.AnchorPoint = lastAnchor end)
		end
	end)

	-- Restore from mini button
	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.fromOffset(0,0)
		local target = toggledMax and UDim2.new(0.96,0,0.94,0) or windowTargetSize
		Window.AnchorPoint = toggledMax and Vector2.new(0.5,0.5) or Window.AnchorPoint
		Window.Position = toggledMax and UDim2.new(0.5,0.5) or Window.Position
		TweenService:Create(Window, TweenInfo.new(0.32, Enum.EasingStyle.Back, Enum.EasingDirection.Out), { Size = target }):Play()
	end)

	-- Close confirmation
	local function ShowCloseConfirm()
		BtnYellow.Active = false; BtnGreen.Active = false; BtnRed.Active = false
		local Overlay = Instance.new("Frame")
		Overlay.Size = UDim2.new(1,0,1,0)
		Overlay.BackgroundColor3 = Color3.fromRGB(0,0,0)
		Overlay.BackgroundTransparency = 0.6
		Overlay.ZIndex = 1200
		Overlay.Parent = Window

		local ConfirmWindow = Instance.new("Frame")
		ConfirmWindow.Size = UDim2.fromOffset(380,160)
		ConfirmWindow.AnchorPoint = Vector2.new(0.5,0.5)
		ConfirmWindow.Position = UDim2.new(0.5,0,0.5,0)
		ConfirmWindow.BackgroundColor3 = Color3.fromRGB(25,25,30)
		ConfirmWindow.ZIndex = 1201
		ConfirmWindow.Parent = Overlay
		Instance.new("UICorner", ConfirmWindow).CornerRadius = UDim.new(0,12)

		local confirmStroke = Instance.new("UIStroke", ConfirmWindow)
		confirmStroke.Color = WindowStroke.Color
		confirmStroke.Thickness = 2.5
		confirmStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
		StartNeonLoop(confirmStroke)

		local ConfirmText = Instance.new("TextLabel", ConfirmWindow)
		ConfirmText.Size = UDim2.new(1,-32,0,48)
		ConfirmText.Position = UDim2.fromOffset(16,20)
		ConfirmText.BackgroundTransparency = 1
		ConfirmText.Text = "Are you sure you want to close the UI?"
		ConfirmText.TextColor3 = Color3.fromRGB(230,230,230)
		ConfirmText.Font = Enum.Font.GothamBold
		ConfirmText.TextSize = 18
		ConfirmText.TextWrapped = true

		local ButtonsFrame = Instance.new("Frame", ConfirmWindow)
		ButtonsFrame.Size = UDim2.new(1,0,0,40)
		ButtonsFrame.Position = UDim2.new(0,0,1,-20)
		ButtonsFrame.AnchorPoint = Vector2.new(0,1)
		ButtonsFrame.BackgroundTransparency = 1

		local layout = Instance.new("UIListLayout", ButtonsFrame)
		layout.FillDirection = Enum.FillDirection.Horizontal
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		layout.Padding = UDim.new(0,16)

		local ConfirmBtn = Instance.new("TextButton", ButtonsFrame)
		ConfirmBtn.Size = UDim2.new(0,120,0,36)
		ConfirmBtn.BackgroundColor3 = Color3.fromRGB(0,170,255)
		ConfirmBtn.Text = "Confirm"
		ConfirmBtn.TextColor3 = Color3.fromRGB(230,230,230)
		ConfirmBtn.Font = Enum.Font.GothamBold
		ConfirmBtn.TextSize = 16
		Instance.new("UICorner", ConfirmBtn).CornerRadius = UDim.new(0,8)

		local CancelBtn = Instance.new("TextButton", ButtonsFrame)
		CancelBtn.Size = UDim2.new(0,120,0,36)
		CancelBtn.BackgroundColor3 = Color3.fromRGB(45,45,50)
		CancelBtn.Text = "Cancel"
		CancelBtn.TextColor3 = Color3.fromRGB(220,220,220)
		CancelBtn.Font = Enum.Font.GothamBold
		CancelBtn.TextSize = 16
		Instance.new("UICorner", CancelBtn).CornerRadius = UDim.new(0,8)

		ConfirmBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			BtnYellow.Active = true; BtnGreen.Active = true; BtnRed.Active = true
		end)
	end
	BtnRed.MouseButton1Click:Connect(ShowCloseConfirm)

	-- Finalize
	if typeof(Callback) == "function" then pcall(Callback, Win) end
	return Win
end

return KazeUI
