--// Kaze UI â€” WindUI-inspired Modular Design
--// Single-file, mobile-friendly, theme-driven, factory-based
--// Supports: Core â†’ Tabs â†’ Elements
--// Author: Kazu (with AI collaboration ðŸ’™)

local KazeUI = {}
KazeUI.__index = KazeUI

--// === SERVICES ===
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

--// === SCREEN GUI ===
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// === SCALING (Mobile + Desktop) ===
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
	local size = Camera.ViewportSize
	if size.X < 600 then
		UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
	else
		UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
	end
end

UpdateScale()
Camera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// === THEME SYSTEM ===
local Theme = {
	-- Colors
	WindowBG = Color3.fromRGB(20, 20, 25),
	TopBarBG = Color3.fromRGB(15, 15, 20),
	Accent = Color3.fromRGB(0, 160, 255),
	AccentGlow = Color3.fromRGB(0, 255, 255),
	TextPrimary = Color3.fromRGB(235, 235, 235),
	TextSecondary = Color3.fromRGB(160, 160, 160),
	ButtonBG = Color3.fromRGB(25, 25, 30),
	CloseRed = Color3.fromRGB(255, 90, 90),
	-- Fonts
	FontBold = Enum.Font.GothamBold,
	Font = Enum.Font.Gotham,

	-- Sizes
	WindowWidth = 650,
	WindowHeight = 420,
	TopBarHeight = 56,
	MiniButtonSize = 60,
	CornerRadius = 14,
	ButtonCornerRadius = 8,
}

--// === UTILITY FUNCTIONS ===
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id):gsub("%D", "")
	return id == "" and "" or ("rbxassetid://" .. id)
end

local function Create(instanceType, props, parent)
	local inst = Instance.new(instanceType)
	for k, v in pairs(props) do
		inst[k] = v
	end
	if parent then inst.Parent = parent end
	return inst
end

local function MakeDraggable(dragPart, target)
	local dragging, dragStart, startPos
	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = target.Position
		end
	end)
	dragPart.InputChanged:Connect(function(input)
		if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) and dragging then
			local delta = input.Position - dragStart
			target.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
	UIS.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = false		end
	end)
end

--// === CORE: WINDOW SYSTEM ===
local Core = {}
function Core.CreateWindow(config)
	config = config or {}
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local IconID = FormatImage(config.Icon or "6031763447")
	local OpenIconID = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")

	-- Window
	local Window = Create("Frame", {
		Name = "MainWindow",
		Size = UDim2.fromOffset(Theme.WindowWidth, Theme.WindowHeight),
		Position = UDim2.fromScale(0.5, 0.5),
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundColor3 = Theme.WindowBG,
		BorderSizePixel = 0,
		ClipsDescendants = true,
	}, ScreenGui)
	Create("UICorner", { CornerRadius = UDim.new(0, Theme.CornerRadius) }, Window)

	local Stroke = Create("UIStroke", {
		Color = Theme.Accent,
		Thickness = 2.5,
	})
	Stroke.Parent = Window

	spawn(function()
		while Window.Parent do
			TweenService:Create(Stroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
				Color = Theme.AccentGlow
			}):Play()
			task.wait(1.5)
		end
	end)

	-- Top Bar
	local TopBar = Create("Frame", {
		Name = "TopBar",
		Size = UDim2.new(1, 0, 0, Theme.TopBarHeight),
		BackgroundColor3 = Theme.TopBarBG,
		BorderSizePixel = 0,
	}, Window)
	Create("UICorner", { CornerRadius = UDim.new(0, Theme.CornerRadius) }, TopBar)
	MakeDraggable(TopBar, Window)
	-- Icon
	Create("ImageLabel", {
		Size = UDim2.fromOffset(32, 32),
		Position = UDim2.fromOffset(14, 12),
		BackgroundTransparency = 1,
		Image = IconID,
	}, TopBar):ApplyStrokes()

	-- Title
	Create("TextLabel", {
		Size = UDim2.new(1, -160, 0, 22),
		Position = UDim2.fromOffset(56, 8),
		BackgroundTransparency = 1,
		Text = Title,
		TextColor3 = Theme.TextPrimary,
		Font = Theme.FontBold,
		TextSize = 16,
		TextXAlignment = Enum.TextXAlignment.Left,
	}, TopBar)

	-- Subtitle
	Create("TextLabel", {
		Size = UDim2.new(1, -160, 0, 18),
		Position = UDim2.fromOffset(56, 30),
		BackgroundTransparency = 1,
		Text = Author .. " | v" .. Version,
		TextColor3 = Theme.TextSecondary,
		Font = Theme.Font,
		TextSize = 13,
		TextXAlignment = Enum.TextXAlignment.Left,
	}, TopBar)

	-- Minimize Button
	local Minimize = Create("TextButton", {
		Size = UDim2.fromOffset(36, 36),
		Position = UDim2.new(1, -88, 0.5, -18),
		Text = "â€”",
		Font = Theme.FontBold,
		TextSize = 20,
		TextColor3 = Color3.fromRGB(220, 220, 220),
		BackgroundColor3 = Theme.ButtonBG,
		BorderSizePixel = 0,
	}, TopBar)
	Create("UICorner", { CornerRadius = UDim.new(1, 0) }, Minimize)

	-- Close Button
	local Close = Create("TextButton", {
		Size = UDim2.fromOffset(36, 36),
		Position = UDim2.new(1, -44, 0.5, -18),		Text = "âœ•",
		Font = Theme.FontBold,
		TextSize = 18,
		TextColor3 = Theme.CloseRed,
		BackgroundColor3 = Theme.ButtonBG,
		BorderSizePixel = 0,
	}, TopBar)
	Create("UICorner", { CornerRadius = UDim.new(1, 0) }, Close)

	-- Content Area
	local Content = Create("Frame", {
		Position = UDim2.fromOffset(0, Theme.TopBarHeight),
		Size = UDim2.new(1, 0, 1, -Theme.TopBarHeight),
		BackgroundTransparency = 1,
	}, Window)

	-- Mini Button (60x60)
	local MiniButton = Create("ImageButton", {
		Name = "MiniButton",
		Size = UDim2.fromOffset(0, 0),
		Position = UDim2.fromScale(0.1, 0.1),
		BackgroundColor3 = Theme.WindowBG,
		BorderSizePixel = 0,
		Visible = false,
		ZIndex = 999,
		Image = OpenIconID,
		ScaleType = Enum.ScaleType.Slice,
		SliceCenter = Rect.new(4, 4, 60, 60),
	}, ScreenGui)
	local miniCorner = Create("UICorner", { CornerRadius = UDim.new(0, 12) }, MiniButton)
	local miniStroke = Create("UIStroke", {
		Color = Theme.Accent,
		Thickness = 2.5,
		ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
		LineJoinMode = Enum.LineJoinMode.Bevel,
	}, MiniButton)

	spawn(function()
		while MiniButton.Parent do
			TweenService:Create(miniStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
				Color = Theme.AccentGlow
			}):Play()
			task.wait(1.5)
		end
	end)

	Create("UIPadding", {
		PaddingTop = UDim.new(0, 4),
		PaddingBottom = UDim.new(0, 4),
		PaddingLeft = UDim.new(0, 4),		PaddingRight = UDim.new(0, 4),
	}, MiniButton)

	MakeDraggable(MiniButton, MiniButton)

	-- Minimize Logic
	Minimize.MouseButton1Click:Connect(function()
		Window.Visible = false
		MiniButton.Visible = true
		TweenService:Create(MiniButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Size = UDim2.fromOffset(Theme.MiniButtonSize, Theme.MiniButtonSize)
		}):Play()
	end)

	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Size = UDim2.fromOffset(Theme.WindowWidth, Theme.WindowHeight)
		}):Play()
	end)

	-- Close Confirmation
	local function ShowCloseConfirm()
		Minimize.Active = false
		Close.Active = false

		local Overlay = Create("Frame", {
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundColor3 = Color3.new(),
			BackgroundTransparency = 0.6,
			ZIndex = 20,
			Parent = Window,
		})

		local ConfirmWin = Create("Frame", {
			Size = UDim2.fromOffset(350, 150),
			AnchorPoint = Vector2.new(0.5, 0.5),
			Position = UDim2.fromScale(0.5, 0.5),
			BackgroundColor3 = Color3.fromRGB(25, 25, 30),
			ZIndex = 21,
		}, Overlay)
		Create("UICorner", { CornerRadius = UDim.new(0, 12) }, ConfirmWin)

		Create("TextLabel", {
			Size = UDim2.new(1, -32, 0, 48),
			Position = UDim2.fromOffset(16, 20),
			BackgroundTransparency = 1,
			Text = "Are you sure you want to close the UI?",			TextColor3 = Color3.fromRGB(230, 230, 230),
			Font = Theme.FontBold,
			TextSize = 18,
			TextWrapped = true,
			ZIndex = 22,
		}, ConfirmWin)

		local Buttons = Create("Frame", {
			Size = UDim2.new(1, 0, 0, 40),
			Position = UDim2.new(0, 0, 1, -20),
			AnchorPoint = Vector2.new(0, 1),
			BackgroundTransparency = 1,
			ZIndex = 22,
		}, ConfirmWin)

		Create("UIListLayout", {
			FillDirection = Enum.FillDirection.Horizontal,
			HorizontalAlignment = Enum.HorizontalAlignment.Center,
			Padding = UDim.new(0, 16),
		}, Buttons)

		local ConfirmBtn = Create("TextButton", {
			Size = UDim2.new(0, 120, 0, 36),
			BackgroundColor3 = Color3.fromRGB(0, 170, 255),
			Text = "Confirm",
			TextColor3 = Color3.fromRGB(230, 230, 230),
			Font = Theme.FontBold,
			TextSize = 16,
			ZIndex = 23,
		}, Buttons)
		Create("UICorner", { CornerRadius = UDim.new(0, Theme.ButtonCornerRadius) }, ConfirmBtn)

		local CancelBtn = Create("TextButton", {
			Size = UDim2.new(0, 120, 0, 36),
			BackgroundColor3 = Color3.fromRGB(45, 45, 50),
			Text = "Cancel",
			TextColor3 = Color3.fromRGB(220, 220, 220),
			Font = Theme.FontBold,
			TextSize = 16,
			ZIndex = 23,
		}, Buttons)
		Create("UICorner", { CornerRadius = UDim.new(0, Theme.ButtonCornerRadius) }, CancelBtn)

		ConfirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			Minimize.Active = true
			Close.Active = true		end)
	end

	Close.MouseButton1Click:Connect(ShowCloseConfirm)

	-- Return public API
	return setmetatable({
		Window = Window,
		Content = Content,
		Theme = Theme,
		CreateTab = function(self, name, icon)
			return Tabs.Create(self, name, icon)
		end
	}, { __index = Core })
end

--// === TABS MODULE ===
local Tabs = {}
function Tabs.Create(parentWindow, tabName, iconId)
	local tabData = {
		Name = tabName,
		Icon = FormatImage(iconId),
		Window = parentWindow,
		Content = parentWindow.Content,
		CurrentY = 0,
		Sections = {},
	}

	-- For now, we'll render all tabs in the same content area (no switching UI yet)
	-- You can extend this later with tab buttons at the top/side

	function tabData:Section(title)
		local sectionFrame = Create("Frame", {
			Position = UDim2.fromOffset(16, self.CurrentY),
			Size = UDim2.new(1, -32, 0, 32),
			BackgroundTransparency = 1,
		}, self.Content)

		Create("TextLabel", {
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundTransparency = 1,
			Text = title,
			TextColor3 = Theme.TextPrimary,
			Font = Theme.FontBold,
			TextSize = 16,
		}, sectionFrame)

		self.CurrentY += 40

		return sectionFrame	end

	-- Element Factories
	function tabData:AddParagraph(title, desc)
		local frame = Create("Frame", {
			Position = UDim2.fromOffset(16, self.CurrentY),
			Size = UDim2.new(1, -32, 0, 40),
			BackgroundTransparency = 1,
		}, self.Content)

		local titleLabel = Create("TextLabel", {
			Size = UDim2.new(1, 0, 0, 18),
			BackgroundTransparency = 1,
			Text = title,
			TextColor3 = Theme.TextPrimary,
			Font = Theme.FontBold,
			TextSize = 15,
			TextXAlignment = Enum.TextXAlignment.Left,
		}, frame)

		local descLabel = Create("TextLabel", {
			Size = UDim2.new(1, 0, 0, 18),
			Position = UDim2.fromOffset(0, 18),
			BackgroundTransparency = 1,
			Text = desc,
			TextColor3 = Theme.TextSecondary,
			Font = Theme.Font,
			TextSize = 14,
			TextXAlignment = Enum.TextXAlignment.Left,
			TextWrapped = true,
			TextYAlignment = Enum.TextYAlignment.Top,
		}, frame)

		-- Auto-size height based on text
		descLabel:GetPropertyChangedSignal("TextBounds"):Connect(function()
			local h = math.max(descLabel.TextBounds.Y + 22, 40)
			frame.Size = UDim2.new(1, -32, 0, h)
		end)

		self.CurrentY += 50
		return frame
	end

	function tabData:AddButton(config)
		config = config or {}
		local title = config.Title or "Button"
		local desc = config.Description or ""
		local callback = config.Callback or function() end

		local hasDesc = desc ~= ""
		local frame = Create("Frame", {
			Position = UDim2.fromOffset(16, self.CurrentY),
			Size = UDim2.new(1, -32, 0, hasDesc and 60 or 36),
			BackgroundTransparency = 1,
		}, self.Content)

		local button = Create("TextButton", {
			Size = UDim2.new(1, 0, 0, hasDesc and 60 or 36),
			BackgroundColor3 = Theme.ButtonBG,
			BorderSizePixel = 0,
			Text = "",
		}, frame)
		Create("UICorner", { CornerRadius = UDim.new(0, 8) }, button)

		local titleLabel = Create("TextLabel", {
			Size = UDim2.new(1, -8, hasDesc and 0.5 or 1, hasDesc and -4 or 0),
			Position = hasDesc and UDim2.fromOffset(8, 4) or UDim2.fromOffset(8, 0),
			BackgroundTransparency = 1,
			Text = title,
			TextColor3 = Theme.TextPrimary,
			Font = Theme.FontBold,
			TextSize = 15,
			TextXAlignment = Enum.TextXAlignment.Left,
		}, button)

		if hasDesc then
			local descLabel = Create("TextLabel", {
				Size = UDim2.new(1, -8, 0.5, -4),
				Position = UDim2.fromOffset(8, 30),
				BackgroundTransparency = 1,
				Text = desc,
				TextColor3 = Theme.TextSecondary,
				Font = Theme.Font,
				TextSize = 13,
				TextXAlignment = Enum.TextXAlignment.Left,
				TextWrapped = true,
			}, button)
		end

		button.MouseButton1Click:Connect(callback)

		self.CurrentY += (hasDesc and 70 or 46)
		return button
	end

	return tabData
end

--// === FINAL EXPORT ===function KazeUI:CreateWindow(config)
	return Core.CreateWindow(config)
end

return KazeUI
