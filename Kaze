-- KazeUI v2.3 (fixed & cleaned)
-- Works with: Window:CreateTab(...):Section(...):Paragraph(...)

local KazeUI = {}
KazeUI.__index = KazeUI

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local TextService = game:GetService("TextService")
local LP = Players.LocalPlayer

-- === THEME (slim & modern) ===
local Theme = {
	PrimaryColor = Color3.fromRGB(0, 160, 255),
	NeonGlow = Color3.fromRGB(0, 255, 255),
	Background = Color3.fromRGB(20, 20, 25),
	Foreground = Color3.fromRGB(18, 18, 23),
	TopBar = Color3.fromRGB(15, 15, 20),
	StrokeThickness = 1.5,  -- slim strokes

	TabInactive = Color3.fromRGB(24, 24, 28),
	TabActive = Color3.fromRGB(32, 32, 36),
	TabHover = Color3.fromRGB(28, 28, 31),
	TabTextInactive = Color3.fromRGB(200, 200, 200),
	TabTextActive = Color3.fromRGB(240, 240, 240),

	ParagraphBg = Color3.fromRGB(24, 24, 28),
	SectionTitle = Color3.fromRGB(0, 120, 255),
	Separator = Color3.fromRGB(38, 38, 42),
	LabelText = Color3.fromRGB(220, 220, 220),

	ButtonConfirm = Color3.fromRGB(0, 170, 255),
	ButtonCancel = Color3.fromRGB(45, 45, 50),
}

-- === HELPERS ===
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id)
	local clean = string.gsub(id, "%D", "")
	return (clean ~= "") and ("rbxassetid://" .. clean) or ""
end

local function MakeDraggable(dragPart, targetPart)
	local dragging = false
	local dragStart, startPos
	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			targetPart.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
end

local function StartNeonLoop(target)
	if not target then return end
	spawn(function()
		while target and target.Parent do
			local propName = pcall(function() return target.Color end) and "Color" or
							(pcall(function() return target.BackgroundColor3 end) and "BackgroundColor3") or nil
			if not propName then break end
			local tweenInfo = TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
			local ok, tween = pcall(function()
				return TweenService:Create(target, tweenInfo, { [propName] = Theme.NeonGlow })
			end)
			if ok and tween then tween:Play() end
			break
		end
	end)
end

-- SAFE WIDTH (try AbsoluteSize, fallback)
local function GetWidth(parent)
	if not parent then return 520 end
	-- Prefer AbsoluteSize when available
	if typeof(parent) == "Instance" and parent:IsA("GuiObject") and parent.AbsoluteSize and parent.AbsoluteSize.X and parent.AbsoluteSize.X > 0 then
		return parent.AbsoluteSize.X * 0.95
	end
	-- Fallback to Size.Offset when possible
	if parent.Size and parent.Size.X and parent.Size.X.Offset and parent.Size.X.Offset > 0 then
		return parent.Size.X.Offset * 0.95
	end
	return 520
end

-- ELEMENTS FACTORY
local Elements = {}

function Elements.CreateParagraph(parentFrame, strokeColor, title, body)
	title = tostring(title or "")
	body = tostring(body or "")

	local measuredWidth = GetWidth(parentFrame)

	local titleHeight = 0
	if title ~= " " and title ~= "" then
		local ts = TextService:GetTextSize(title, 16, Enum.Font.GothamBold, Vector2.new(math.max(10, measuredWidth - 32), 1000))
		titleHeight = math.max(18, math.ceil(ts.Y))
	end

	local bodySize = TextService:GetTextSize(body, 14, Enum.Font.Gotham, Vector2.new(math.max(10, measuredWidth - 32), 2000))
	local bodyHeight = math.ceil(bodySize.Y)
	local totalHeight = 8 + titleHeight + 4 + bodyHeight + 8

	local wrapper = Instance.new("Frame")
	wrapper.Name = "ParagraphWrapper"
	wrapper.Size = UDim2.new(1, 0, 0, totalHeight + 10)
	wrapper.BackgroundTransparency = 1
	wrapper.AutomaticSize = Enum.AutomaticSize.Y
	wrapper.Parent = parentFrame

	local paraFrame = Instance.new("Frame")
	paraFrame.Name = "Paragraph"
	paraFrame.AnchorPoint = Vector2.new(0.5, 0)
	paraFrame.Position = UDim2.new(0.5, 0, 0, 5)
	paraFrame.Size = UDim2.new(0.95, 0, 0, totalHeight)
	paraFrame.BackgroundColor3 = Theme.ParagraphBg
	paraFrame.BorderSizePixel = 0
	local uc = Instance.new("UICorner", paraFrame)
	uc.CornerRadius = UDim.new(0, 6)
	paraFrame.Parent = wrapper

	local glow = Instance.new("Frame")
	glow.Name = "ParagraphGlow"
	glow.AnchorPoint = Vector2.new(0.5, 0)
	glow.Position = UDim2.new(0.5, 0, 0, 3)
	glow.Size = UDim2.new(0.96, 0, 0, totalHeight + 8)
	glow.BackgroundTransparency = 0.97
	glow.BackgroundColor3 = strokeColor or Theme.PrimaryColor
	local gc = Instance.new("UICorner", glow)
	gc.CornerRadius = UDim.new(0, 8)
	glow.Parent = wrapper
	StartNeonLoop(glow)

	local paraStroke = Instance.new("UIStroke", paraFrame)
	paraStroke.Thickness = Theme.StrokeThickness
	paraStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Inner
	paraStroke.Color = strokeColor or Theme.PrimaryColor
	StartNeonLoop(paraStroke)

	local inner = Instance.new("Frame")
	inner.Size = UDim2.new(1, -18, 1, -18)
	inner.Position = UDim2.fromOffset(9, 9)
	inner.BackgroundTransparency = 1
	inner.Parent = paraFrame

	local titleLabel
	if title ~= " " and title ~= "" then
		titleLabel = Instance.new("TextLabel")
		titleLabel.Name = "ParagraphTitle"
		titleLabel.Size = UDim2.new(1, 0, 0, titleHeight)
		titleLabel.Position = UDim2.fromOffset(0, 0)
		titleLabel.BackgroundTransparency = 1
		titleLabel.Text = title
		titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
		titleLabel.Font = Enum.Font.GothamBold
		titleLabel.TextSize = 15
		titleLabel.TextXAlignment = Enum.TextXAlignment.Left
		titleLabel.TextWrapped = true
		titleLabel.Parent = inner
	end

	local bodyLabel = Instance.new("TextLabel")
	bodyLabel.Name = "ParagraphBody"
	bodyLabel.Size = UDim2.new(1, 0, 0, bodyHeight)
	bodyLabel.Position = UDim2.fromOffset(0, titleHeight + 4)
	bodyLabel.BackgroundTransparency = 1
	bodyLabel.Text = body
	bodyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	bodyLabel.Font = Enum.Font.Gotham
	bodyLabel.TextSize = 13
	bodyLabel.TextWrapped = true
	bodyLabel.TextXAlignment = Enum.TextXAlignment.Left
	bodyLabel.TextYAlignment = Enum.TextYAlignment.Top
	bodyLabel.Parent = inner

	return {
		Wrapper = wrapper,
		Frame = paraFrame,
		BodyLabel = bodyLabel,
		SetText = function(self, newText)
			newText = tostring(newText or " ")
			bodyLabel.Text = newText
			task.defer(function()
				local w = GetWidth(parentFrame)
				local newTitleH, newBodyH = 0, 0
				if title ~= " " and title ~= "" then
					local ts2 = TextService:GetTextSize(title, 16, Enum.Font.GothamBold, Vector2.new(math.max(10, w - 32), 1000))
					newTitleH = math.max(18, math.ceil(ts2.Y))
				end
				local newBodySize = TextService:GetTextSize(newText, 14, Enum.Font.Gotham, Vector2.new(math.max(10, w - 32), 2000))
				newBodyH = math.ceil(newBodySize.Y)
				local newTotal = 8 + newTitleH + 4 + newBodyH + 8
				paraFrame.Size = UDim2.new(0.95, 0, 0, newTotal)
				glow.Size = UDim2.new(0.96, 0, 0, newTotal + 8)
				wrapper.Size = UDim2.new(1, 0, 0, newTotal + 10)
				if titleLabel then titleLabel.Size = UDim2.new(1, 0, 0, newTitleH) end
				bodyLabel.Size = UDim2.new(1, 0, 0, newBodyH)
			end)
		end,
	}
end

function Elements.CreateSection(parentFrame, title)
	title = tostring(title or " ")
	local sectionFrame = Instance.new("Frame")
	sectionFrame.Name = "Section_" .. title
	sectionFrame.Size = UDim2.new(1, -20, 0, 0)
	sectionFrame.BackgroundTransparency = 1
	sectionFrame.AutomaticSize = Enum.AutomaticSize.Y
	sectionFrame.Parent = parentFrame

	local sectionLayout = Instance.new("UIListLayout")
	sectionLayout.SortOrder = Enum.SortOrder.LayoutOrder
	sectionLayout.Padding = UDim.new(0, 5)
	sectionLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	sectionLayout.VerticalAlignment = Enum.VerticalAlignment.Top
	sectionLayout.Parent = sectionFrame

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "SectionTitle"
	titleLabel.Size = UDim2.new(1, 0, 0, 32)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = title
	titleLabel.TextColor3 = Theme.SectionTitle
	titleLabel.Font = Enum.Font.GothamBold
	titleLabel.TextSize = 18
	titleLabel.TextWrapped = true
	titleLabel.TextXAlignment = Enum.TextXAlignment.Center
	titleLabel.Parent = sectionFrame

	local sep = Instance.new("Frame")
	sep.Name = "SectionSeparator"
	sep.Size = UDim2.new(0.6, 0, 0, 1)
	sep.BackgroundColor3 = Theme.Separator
	sep.BorderSizePixel = 0
	local sc = Instance.new("UICorner", sep)
	sc.CornerRadius = UDim.new(0, 2)
	sep.Parent = sectionFrame

	local sectionContent = Instance.new("Frame")
	sectionContent.Name = "SectionContent"
	sectionContent.Size = UDim2.new(1, 0, 0, 0)
	sectionContent.BackgroundTransparency = 1
	sectionContent.AutomaticSize = Enum.AutomaticSize.Y
	sectionContent.Parent = sectionFrame

	local secLayout = Instance.new("UIListLayout")
	secLayout.SortOrder = Enum.SortOrder.LayoutOrder
	secLayout.Padding = UDim.new(0, 6)
	secLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	secLayout.VerticalAlignment = Enum.VerticalAlignment.Top
	secLayout.Parent = sectionContent

	return {
		Frame = sectionFrame,
		TitleLabel = titleLabel,
		AddLabel = function(self, text)
			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, -36, 0, 22)
			label.BackgroundTransparency = 1
			label.Text = tostring(text or " ")
			label.TextColor3 = Theme.LabelText
			label.Font = Enum.Font.Gotham
			label.TextSize = 13
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = sectionContent
			return label
		end,
		AddParagraph = function(self, ptitle, pbody)
			return Elements.CreateParagraph(sectionContent, Theme.PrimaryColor, ptitle, pbody)
		end,
	}
end

-- TABS MODULE
local Tabs = {}

function Tabs.New(sidebar, pages, strokeColor)
	local tabsScroller = Instance.new("ScrollingFrame")
	tabsScroller.Name = "TabsScroller"
	tabsScroller.BackgroundTransparency = 1
	tabsScroller.ScrollBarThickness = 4
	tabsScroller.CanvasSize = UDim2.new(0, 0, 0, 0)
	tabsScroller.AutomaticCanvasSize = Enum.AutomaticSize.Y
	tabsScroller.ScrollBarImageColor3 = Color3.fromRGB(40, 40, 45)
	tabsScroller.Size = UDim2.new(1, -16, 1, -16)
	tabsScroller.Position = UDim2.fromOffset(8, 8)
	tabsScroller.Parent = sidebar

	local tabsList = Instance.new("Frame")
	tabsList.Name = "TabsList"
	tabsList.BackgroundTransparency = 1
	tabsList.Size = UDim2.new(1, 0, 0, 0)
	tabsList.AutomaticSize = Enum.AutomaticSize.Y
	tabsList.Parent = tabsScroller

	local tabsLayout = Instance.new("UIListLayout")
	tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabsLayout.Padding = UDim.new(0, 6)
	tabsLayout.Parent = tabsList

	local createdTabs = {}

	local function activateTab(targetTab)
		for _, t in ipairs(createdTabs) do
			TweenService:Create(t.Button, TweenInfo.new(0.12), { BackgroundColor3 = Theme.TabInactive }):Play()
			t.Indicator.Visible = false
			t.Page.Visible = false
			t.Label.TextColor3 = Theme.TabTextInactive
			t.Label.Font = Enum.Font.Gotham
		end
		TweenService:Create(targetTab.Button, TweenInfo.new(0.12), { BackgroundColor3 = Theme.TabActive }):Play()
		targetTab.Indicator.Visible = true
		targetTab.Page.Visible = true
		targetTab.Label.TextColor3 = Theme.TabTextActive
		targetTab.Label.Font = Enum.Font.GothamBold
	end

	return {
		CreateTab = function(self, name, iconId)
			name = tostring(name or "Tab")
			local formattedIcon = FormatImage(iconId or "")

			local btn = Instance.new("TextButton")
			btn.Name = "TabButton_" .. name
			btn.Size = UDim2.new(1, -16, 0, 40)
			btn.BackgroundColor3 = Theme.TabInactive
			btn.BorderSizePixel = 0
			btn.Text = " "
			btn.AutoButtonColor = false
			btn.LayoutOrder = #createdTabs + 1
			btn.Parent = tabsList

			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 5)
			local leftIndicator = Instance.new("Frame")
			leftIndicator.Name = "LeftIndicator"
			leftIndicator.Size = UDim2.new(0, 3, 1, 0)
			leftIndicator.BackgroundColor3 = strokeColor or Theme.PrimaryColor
			leftIndicator.BorderSizePixel = 0
			leftIndicator.Visible = false
			Instance.new("UICorner", leftIndicator).CornerRadius = UDim.new(0, 3)
			leftIndicator.Parent = btn

			local iconLabel = Instance.new("ImageLabel")
			iconLabel.Name = "Icon"
			iconLabel.Size = UDim2.fromOffset(24, 24)
			iconLabel.Position = UDim2.new(0, 10, 0.5, -12)
			iconLabel.BackgroundTransparency = 1
			iconLabel.Image = formattedIcon
			Instance.new("UICorner", iconLabel).CornerRadius = UDim.new(1, 0)
			iconLabel.Parent = btn

			local txt = Instance.new("TextLabel")
			txt.Name = "Label"
			txt.Size = UDim2.new(1, -52, 1, 0)
			txt.Position = UDim2.fromOffset(44, 0)
			txt.BackgroundTransparency = 1
			txt.Text = name
			txt.TextColor3 = Theme.TabTextInactive
			txt.Font = Enum.Font.Gotham
			txt.TextSize = 14
			txt.TextXAlignment = Enum.TextXAlignment.Left
			txt.Parent = btn

			local page = Instance.new("Frame")
			page.Name = "Page_" .. name
			page.Size = UDim2.new(1, 0, 1, 0)
			page.BackgroundTransparency = 1
			page.Visible = false
			page.Parent = pages

			local pageContent = Instance.new("Frame")
			pageContent.Name = "PageContent"
			pageContent.Size = UDim2.new(1, 0, 1, 0)
			pageContent.BackgroundTransparency = 1
			pageContent.Parent = page

			local contentLayout = Instance.new("UIListLayout")
			contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
			contentLayout.Padding = UDim.new(0, 8)
			contentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
			contentLayout.VerticalAlignment = Enum.VerticalAlignment.Top
			contentLayout.Parent = pageContent

			local tabObj = {
				Button = btn,
				Indicator = leftIndicator,
				Label = txt,
				Icon = iconLabel,
				Page = page,
				PageContent = pageContent,
			}
			table.insert(createdTabs, tabObj)

			btn.MouseEnter:Connect(function()
				if not leftIndicator.Visible then
					TweenService:Create(btn, TweenInfo.new(0.10), { BackgroundColor3 = Theme.TabHover }):Play()
					txt.TextColor3 = Color3.fromRGB(220, 220, 220)
				end
			end)
			btn.MouseLeave:Connect(function()
				if not leftIndicator.Visible then
					TweenService:Create(btn, TweenInfo.new(0.10), { BackgroundColor3 = Theme.TabInactive }):Play()
					txt.TextColor3 = Theme.TabTextInactive
				end
			end)
			btn.MouseButton1Click:Connect(function() activateTab(tabObj) end)

			if #createdTabs == 1 then activateTab(tabObj) end

			return {
				Page = page,
				PageContent = pageContent,
				Paragraph = function(_, ptitle, pbody)
					return Elements.CreateParagraph(pageContent, strokeColor or Theme.PrimaryColor, ptitle, pbody)
				end,
				Section = function(_, stitle)
					return Elements.CreateSection(pageContent, stitle)
				end,
			}
		end,
	}
end

-- CORE: CreateWindow
function KazeUI:CreateWindow(config)
	config = config or {}
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = FormatImage(config.Icon or "6031763447")
	local OpenIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")
	local Callback = config.Callback

	-- ScreenGui created ONLY inside CreateWindow
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "KazeUI"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	ScreenGui.Parent = LP:WaitForChild("PlayerGui")

	local UIScale = Instance.new("UIScale")
	UIScale.Parent = ScreenGui
	local function UpdateScale()
		local size = workspace.CurrentCamera.ViewportSize
		UIScale.Scale = math.clamp(size.X / 1920, 0.5, 1)
	end
	UpdateScale()
	workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

	-- Window (default size)
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = UDim2.fromOffset(650, 420)
	Window.Position = UDim2.fromScale(0.5, 0.5)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Theme.Background
	Window.BorderSizePixel = 0
	Window.ClipsDescendants = true
	Window.Parent = ScreenGui
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 14)

	local WindowStroke = Instance.new("UIStroke")
	WindowStroke.Color = Theme.PrimaryColor
	WindowStroke.Thickness = Theme.StrokeThickness
	WindowStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Inner
	WindowStroke.Parent = Window
	StartNeonLoop(WindowStroke)

	-- TopBar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 56)
	TopBar.BackgroundColor3 = Theme.TopBar
	TopBar.BorderSizePixel = 0
	TopBar.Parent = Window
	Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 14)
	MakeDraggable(TopBar, Window)

	-- Avatar + labels
	local Avatar = Instance.new("ImageLabel")
	Avatar.Size = UDim2.fromOffset(36, 36)
	Avatar.Position = UDim2.fromOffset(12, 10)
	Avatar.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
	Avatar.Image = MainIcon
	Avatar.Parent = TopBar
	Instance.new("UICorner", Avatar).CornerRadius = UDim.new(1, 0)
	local avatarStroke = Instance.new("UIStroke", Avatar)
	avatarStroke.Color = Color3.fromRGB(0, 140, 200)
	avatarStroke.Thickness = 1
	avatarStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Inner

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, -220, 0, 20)
	TitleLabel.Position = UDim2.fromOffset(56, 8)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(235, 235, 235)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 15
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = TopBar

	local SubLabel = Instance.new("TextLabel")
	SubLabel.Size = UDim2.new(1, -220, 0, 16)
	SubLabel.Position = UDim2.fromOffset(56, 26)
	SubLabel.BackgroundTransparency = 1
	SubLabel.Text = Author .. " | v" .. Version
	SubLabel.TextColor3 = Color3.fromRGB(160, 160, 160)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 12
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.Parent = TopBar

	-- Top divider (thin)
	local TopDivider = Instance.new("Frame")
	TopDivider.Size = UDim2.new(1, 0, 0, 1)
	TopDivider.Position = UDim2.new(0, 0, 1, -1)
	TopDivider.BackgroundColor3 = Theme.PrimaryColor
	TopDivider.BorderSizePixel = 0
	TopDivider.ZIndex = 5
	TopDivider.Parent = TopBar
	Instance.new("UICorner", TopDivider).CornerRadius = UDim.new(0, 3)
	local topDivStroke = Instance.new("UIStroke", TopDivider)
	topDivStroke.Color = Theme.PrimaryColor
	topDivStroke.Thickness = Theme.StrokeThickness
	topDivStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Inner
	StartNeonLoop(topDivStroke)

	-- Traffic lights
	local defaultWindowSize = UDim2.fromOffset(650, 420)
	local lastNormalSize = defaultWindowSize
	local lastNormalPosition = UDim2.fromScale(0.5, 0.5)
	local lastNormalAnchor = Vector2.new(0.5, 0.5)
	local toggledMaximized = false
	local function createCircleButton(name, offsetX, color)
		local btn = Instance.new("TextButton")
		btn.Name = name
		btn.Size = UDim2.fromOffset(16, 16)
		btn.Position = UDim2.new(1, offsetX, 0.5, -8)
		btn.BackgroundColor3 = color
		btn.BorderSizePixel = 0
		btn.Text = " "
		btn.Parent = TopBar
		Instance.new("UICorner", btn).CornerRadius = UDim.new(1, 0)
		local stroke = Instance.new("UIStroke", btn)
		stroke.Color = Color3.fromRGB(0, 0, 0)
		stroke.Thickness = 0.8
		stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Inner
		return btn
	end

	local BtnGreen = createCircleButton("BtnGreen", -110, Color3.fromRGB(117, 204, 50))
	local BtnYellow = createCircleButton("BtnYellow", -82, Color3.fromRGB(255, 204, 51))
	local BtnRed = createCircleButton("BtnRed", -54, Color3.fromRGB(235, 80, 80))

	-- MiniButton
	local MiniButtonSize = UDim2.fromOffset(56, 56)
	local MiniButton = Instance.new("ImageButton")
	MiniButton.Size = MiniButtonSize
	MiniButton.Position = UDim2.fromScale(0.1, 0.1)
	MiniButton.BackgroundColor3 = Theme.Background
	MiniButton.BorderSizePixel = 0
	MiniButton.Visible = false
	MiniButton.ZIndex = 999
	MiniButton.ScaleType = Enum.ScaleType.Slice
	MiniButton.SliceCenter = Rect.new(4, 4, 56, 56)
	MiniButton.Parent = ScreenGui
	Instance.new("UICorner", MiniButton).CornerRadius = UDim.new(0, 11)
	local miniPadding = Instance.new("UIPadding", MiniButton)
	miniPadding.PaddingTop = UDim.new(0, 3); miniPadding.PaddingBottom = UDim.new(0, 3)
	miniPadding.PaddingLeft = UDim.new(0, 3); miniPadding.PaddingRight = UDim.new(0, 3)

	local MiniIcon = Instance.new("ImageLabel")
	MiniIcon.Size = UDim2.fromScale(1, 1)
	MiniIcon.Position = UDim2.fromScale(0.5, 0.5)
	MiniIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	MiniIcon.BackgroundTransparency = 1
	MiniIcon.Image = OpenIcon
	MiniIcon.Parent = MiniButton
	MiniIcon.ZIndex = 1000

	local MiniStroke = Instance.new("UIStroke")
	MiniStroke.Color = Theme.PrimaryColor
	MiniStroke.Thickness = Theme.StrokeThickness
	MiniStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Inner
	MiniStroke.Parent = MiniButton
	StartNeonLoop(MiniStroke)

	MakeDraggable(MiniButton, MiniButton)

	-- Minimize
	local function minimizeWindow()
		Window.Visible = false
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(MiniButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), { Size = MiniButtonSize }):Play()
	end

	BtnYellow.MouseButton1Click:Connect(minimizeWindow)

	BtnGreen.MouseButton1Click:Connect(function()
		if not toggledMaximized then
			lastNormalSize = Window.Size
			lastNormalPosition = Window.Position
			lastNormalAnchor = Window.AnchorPoint
			toggledMaximized = true
			Window.AnchorPoint = Vector2.new(0.5, 0.5)
			Window.Position = UDim2.fromScale(0.5, 0.5)
			TweenService:Create(Window, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), { Size = UDim2.fromScale(0.9, 0.85) }):Play()
		else
			toggledMaximized = false
			TweenService:Create(Window, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), { Size = lastNormalSize, Position = lastNormalPosition }):Play()
			task.delay(0.25, function() Window.AnchorPoint = lastNormalAnchor end)
		end
	end)

	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.fromOffset(0, 0)
		if toggledMaximized then
			Window.AnchorPoint = Vector2.new(0.5, 0.5)
			Window.Position = UDim2.fromScale(0.5, 0.5)
			TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), { Size = UDim2.fromScale(0.9, 0.85) }):Play()
		else
			Window.AnchorPoint = lastNormalAnchor
			Window.Position = lastNormalPosition
			TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), { Size = lastNormalSize, Position = lastNormalPosition }):Play()
		end
	end)

	-- Close confirm (slimmer)
	local function ShowCloseConfirm()
		BtnYellow.Active = false; BtnGreen.Active = false; BtnRed.Active = false
		local Overlay = Instance.new("Frame")
		Overlay.Size = UDim2.new(1, 0, 1, 0)
		Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		Overlay.BackgroundTransparency = 0.6
		Overlay.ZIndex = 50
		Overlay.Parent = Window

		local Shadow = Instance.new("Frame")
		Shadow.Size = UDim2.fromOffset(340, 140)
		Shadow.AnchorPoint = Vector2.new(0.5, 0.5)
		Shadow.Position = UDim2.fromScale(0.5, 0.5)
		Shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		Shadow.BackgroundTransparency = 0.75
		Shadow.ZIndex = 51
		Shadow.Parent = Overlay
		Instance.new("UICorner", Shadow).CornerRadius = UDim.new(0, 12)

		local ConfirmWindow = Instance.new("Frame")
		ConfirmWindow.Size = UDim2.fromOffset(330, 130)
		ConfirmWindow.AnchorPoint = Vector2.new(0.5, 0.5)
		ConfirmWindow.Position = UDim2.fromScale(0.5, 0.5)
		ConfirmWindow.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		ConfirmWindow.ZIndex = 52
		ConfirmWindow.Parent = Overlay
		Instance.new("UICorner", ConfirmWindow).CornerRadius = UDim.new(0, 10)

		local confirmStroke = Instance.new("UIStroke", ConfirmWindow)
		confirmStroke.Color = Theme.PrimaryColor
		confirmStroke.Thickness = Theme.StrokeThickness
		confirmStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Inner
		StartNeonLoop(confirmStroke)

		local ConfirmText = Instance.new("TextLabel")
		ConfirmText.Size = UDim2.new(1, -28, 0, 40)
		ConfirmText.Position = UDim2.fromOffset(14, 18)
		ConfirmText.BackgroundTransparency = 1
		ConfirmText.Text = "Close UI?"
		ConfirmText.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmText.Font = Enum.Font.GothamBold
		ConfirmText.TextSize = 16
		ConfirmText.TextWrapped = true
		ConfirmText.ZIndex = 53
		ConfirmText.Parent = ConfirmWindow

		local ButtonsFrame = Instance.new("Frame")
		ButtonsFrame.Size = UDim2.new(1, 0, 0, 34)
		ButtonsFrame.Position = UDim2.new(0, 0, 1, -18)
		ButtonsFrame.AnchorPoint = Vector2.new(0, 1)
		ButtonsFrame.BackgroundTransparency = 1
		ButtonsFrame.ZIndex = 53
		ButtonsFrame.Parent = ConfirmWindow

		local layout = Instance.new("UIListLayout", ButtonsFrame)
		layout.FillDirection = Enum.FillDirection.Horizontal
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		layout.Padding = UDim.new(0, 12)

		local ConfirmBtn = Instance.new("TextButton")
		ConfirmBtn.Size = UDim2.new(0, 100, 0, 32)
		ConfirmBtn.BackgroundColor3 = Theme.ButtonConfirm
		ConfirmBtn.Text = "Yes"
		ConfirmBtn.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmBtn.Font = Enum.Font.GothamBold
		ConfirmBtn.TextSize = 14
		ConfirmBtn.ZIndex = 54
		ConfirmBtn.Parent = ButtonsFrame
		Instance.new("UICorner", ConfirmBtn).CornerRadius = UDim.new(0, 6)

		local CancelBtn = Instance.new("TextButton")
		CancelBtn.Size = UDim2.new(0, 100, 0, 32)
		CancelBtn.BackgroundColor3 = Theme.ButtonCancel
		CancelBtn.Text = "No"
		CancelBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
		CancelBtn.Font = Enum.Font.GothamBold
		CancelBtn.TextSize = 14
		CancelBtn.ZIndex = 54
		CancelBtn.Parent = ButtonsFrame
		Instance.new("UICorner", CancelBtn).CornerRadius = UDim.new(0, 6)

		ConfirmBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			BtnYellow.Active = true; BtnGreen.Active = true; BtnRed.Active = true
		end)
	end

	BtnRed.MouseButton1Click:Connect(ShowCloseConfirm)

	-- Content area
	local Content = Instance.new("Frame")
	Content.Position = UDim2.fromOffset(0, 56)
	Content.Size = UDim2.new(1, 0, 1, -56)
	Content.BackgroundTransparency = 1
	Content.Parent = Window

	-- Sidebar (180px wide)
	local SideBar = Instance.new("Frame")
	SideBar.Size = UDim2.new(0, 180, 1, 0)
	SideBar.BackgroundColor3 = Theme.Background
	SideBar.BorderSizePixel = 0
	SideBar.Parent = Content
	Instance.new("UICorner", SideBar).CornerRadius = UDim.new(0, 14)

	-- Vertical Divider
	local VertDivider = Instance.new("Frame")
	VertDivider.Size = UDim2.new(0, 2, 1, 0)
	VertDivider.Position = UDim2.new(0, 180, 0, 0)
	VertDivider.BackgroundColor3 = Theme.PrimaryColor
	VertDivider.BorderSizePixel = 0
	VertDivider.Parent = Content
	Instance.new("UICorner", VertDivider).CornerRadius = UDim.new(0, 3)
	local vertDivStroke = Instance.new("UIStroke", VertDivider)
	vertDivStroke.Color = Theme.PrimaryColor
	vertDivStroke.Thickness = Theme.StrokeThickness
	vertDivStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Inner
	StartNeonLoop(vertDivStroke)

	-- Pages (starts at 182, fills rest)
	local Pages = Instance.new("Frame")
	Pages.Position = UDim2.new(0, 182, 0, 0)
	Pages.Size = UDim2.new(1, -182, 1, 0)
	Pages.BackgroundColor3 = Theme.Foreground
	Pages.BorderSizePixel = 0
	Pages.Parent = Content
	Instance.new("UICorner", Pages).CornerRadius = UDim.new(0, 12)

	-- Initialize Tabs
	local TabsModule = Tabs.New(SideBar, Pages, WindowStroke.Color)

	-- Return window API
	local Win = {
		Window = Window,
		Content = Content,
		MiniButton = MiniButton,
		SideBar = SideBar,
		Pages = Pages,
		CreateTab = function(self, name, iconId)
			return TabsModule.CreateTab(name, iconId)
		end,
	}

	if typeof(Callback) == "function" then pcall(Callback) end
	return Win
end

return KazeUI
