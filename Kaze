--// Kaze UI Base â€” Fully Fixed & Aligned to Your Image
--// Window System (PC + Mobile)
--// Features:
--//   â€¢ Larger window (1100Ã—680 by default)
--//   â€¢ Traffic light controls: ðŸŸ¢ Small UI | ðŸŸ¡ Minimize | ðŸ”´ Close
--//   â€¢ 60Ã—60 draggable MiniButton (ZIndex 999)
--//   â€¢ Strict texture sanitizer + zero runtime errors

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Create ScreenGui (safe wait for PlayerGui)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// UIScale for responsive scaling
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	if size.X < 600 then
		UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
	else
		UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
	end
end

UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// âœ… ROBUST Texture ID Sanitizer
-- Handles: "rbxassetid://123", "123", "Rbxtextureid://abc123", etc.
local function FormatImage(id)
	if not id or typeof(id) ~= "string" then return "" end
	local clean = id:gsub("%D", "")  -- keep only digits
	if clean == "" then return "" end
	return "rbxassetid://" .. clean
end

--// Drag Function (Mouse + Touch)local function MakeDraggable(dragPart, targetPart)
	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		if not dragStart or not startPos then return end
		local delta = input.Position - dragStart
		targetPart.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					dragInput = nil
				end
			end)
		end
	end)

	dragPart.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

--// CREATE WINDOW
function KazeUI:CreateWindow(config)
	config = config or {}

	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = FormatImage(config.Icon or "6031763447")
	local OpenIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")
	local MiniButtonSize = UDim2.fromOffset(60, 60)	local Callback = config.Callback

	--// Main Window (1100Ã—680 â€” matches your large UI image)
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = UDim2.fromOffset(1100, 680)
	Window.Position = UDim2.fromScale(0.5, 0.5)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	Window.BorderSizePixel = 0
	Window.Parent = ScreenGui
	Window.ClipsDescendants = true
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 14)

	local WindowStroke = Instance.new("UIStroke")
	WindowStroke.Color = Color3.fromRGB(0, 160, 255)
	WindowStroke.Thickness = 2.5
	WindowStroke.Parent = Window

	spawn(function()
		while Window.Parent do
			local t = TweenService:Create(WindowStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	--// Top Bar (64px tall)
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 64)
	TopBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	TopBar.BorderSizePixel = 0
	TopBar.Parent = Window
	Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 14)
	MakeDraggable(TopBar, Window)

	--// âœ… TRAFFIC LIGHTS â€” macOS-style, top-right, 36Ã—36 circles
	local TrafficContainer = Instance.new("Frame")
	TrafficContainer.Size = UDim2.fromOffset(120, 36)
	TrafficContainer.Position = UDim2.new(1, -136, 0, 16)  -- right-aligned, 16px from top
	TrafficContainer.BackgroundTransparency = 1
	TrafficContainer.Parent = TopBar

	local layout = Instance.new("UIListLayout")
	layout.FillDirection = Enum.FillDirection.Horizontal
	layout.HorizontalAlignment = Enum.HorizontalAlignment.Right
	layout.Padding = UDim.new(0, 8)
	layout.Parent = TrafficContainer
	-- ðŸŸ¢ Green: Small UI Mode (toggle compact size)
	local SmallBtn = Instance.new("TextButton")
	SmallBtn.Size = UDim2.fromOffset(36, 36)
	SmallBtn.BackgroundColor3 = Color3.fromRGB(88, 214, 141)  -- vibrant green
	SmallBtn.BorderSizePixel = 0
	SmallBtn.Text = ""
	SmallBtn.Parent = TrafficContainer
	Instance.new("UICorner", SmallBtn).CornerRadius = UDim.new(0.5, 0)

	-- ðŸŸ¡ Yellow: Minimize
	local MinimizeBtn = Instance.new("TextButton")
	MinimizeBtn.Size = UDim2.fromOffset(36, 36)
	MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 196, 0)  -- gold
	MinimizeBtn.BorderSizePixel = 0
	MinimizeBtn.Text = ""
	MinimizeBtn.Parent = TrafficContainer
	Instance.new("UICorner", MinimizeBtn).CornerRadius = UDim.new(0.5, 0)

	-- ðŸ”´ Red: Close
	local CloseBtn = Instance.new("TextButton")
	CloseBtn.Size = UDim2.fromOffset(36, 36)
	CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 95, 86)  -- soft red
	CloseBtn.BorderSizePixel = 0
	CloseBtn.Text = ""
	CloseBtn.Parent = TrafficContainer
	Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(0.5, 0)

	--// Icon (left of title, adjusted for traffic lights)
	local Icon = Instance.new("ImageLabel")
	Icon.Size = UDim2.fromOffset(32, 32)
	Icon.Position = UDim2.fromOffset(52, 16)
	Icon.BackgroundTransparency = 1
	Icon.Image = MainIcon
	Icon.Parent = TopBar
	Instance.new("UICorner", Icon).CornerRadius = UDim.new(1, 0)

	--// Title & Subtitle
	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, -220, 0, 22)
	TitleLabel.Position = UDim2.fromOffset(96, 10)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(235, 235, 235)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 18
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = TopBar

	local SubLabel = Instance.new("TextLabel")
	SubLabel.Size = UDim2.new(1, -220, 0, 18)	SubLabel.Position = UDim2.fromOffset(96, 32)
	SubLabel.BackgroundTransparency = 1
	SubLabel.Text = Author .. " | v" .. Version
	SubLabel.TextColor3 = Color3.fromRGB(160, 160, 160)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 13
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.Parent = TopBar

	--// Content Frame
	local Content = Instance.new("Frame")
	Content.Position = UDim2.fromOffset(0, 64)
	Content.Size = UDim2.new(1, 0, 1, -64)
	Content.BackgroundTransparency = 1
	Content.Parent = Window

	--// MINI BUTTON (60Ã—60, ZIndex 999)
	local MiniButton = Instance.new("ImageButton")
	MiniButton.Name = "MiniButton"
	MiniButton.Size = MiniButtonSize
	MiniButton.Position = UDim2.fromScale(0.1, 0.1)
	MiniButton.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
MiniButton.BorderSizePixel = 0
	MiniButton.Visible = false
	MiniButton.Parent = ScreenGui
	MiniButton.ZIndex = 999
	MiniButton.ScaleType = Enum.ScaleType.Slice
	MiniButton.SliceCenter = Rect.new(4, 4, 60, 60)

	local miniUICorner = Instance.new("UICorner")
	miniUICorner.CornerRadius = UDim.new(0, 12)
	miniUICorner.Parent = MiniButton

	local miniPadding = Instance.new("UIPadding")
	miniPadding.PaddingTop = UDim.new(0, 4)
	miniPadding.PaddingBottom = UDim.new(0, 4)
	miniPadding.PaddingLeft = UDim.new(0, 4)
	miniPadding.PaddingRight = UDim.new(0, 4)
	miniPadding.Parent = MiniButton

	local MiniIcon = Instance.new("ImageLabel")
	MiniIcon.Size = UDim2.fromScale(1, 1)
	MiniIcon.Position = UDim2.fromScale(0.5, 0.5)
	MiniIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	MiniIcon.BackgroundTransparency = 1
	MiniIcon.Image = OpenIcon
	MiniIcon.Parent = MiniButton
	MiniIcon.ZIndex = 1000

	local MiniStroke = Instance.new("UIStroke")	MiniStroke.Color = Color3.fromRGB(0, 160, 255)
	MiniStroke.Thickness = 2.5
	MiniStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	MiniStroke.LineJoinMode = Enum.LineJoinMode.Bevel
	MiniStroke.Parent = MiniButton

	spawn(function()
		while MiniButton.Parent do
			local t = TweenService:Create(MiniStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)

	MakeDraggable(TopBar, Window)
	MakeDraggable(MiniButton, MiniButton)

	--// SMALL UI MODE TOGGLE (ðŸŸ¢)
	local IS_SMALL = false
	local FULL_SIZE = UDim2.fromOffset(1100, 680)
	local COMPACT_SIZE = UDim2.fromOffset(420, 280)  -- matches your small UI image

	SmallBtn.MouseButton1Click:Connect(function()
		if IS_SMALL then
			Window.Size = FULL_SIZE
			IS_SMALL = false
		else
			Window.Size = COMPACT_SIZE
			IS_SMALL = true
		end
	end)

	--// MINIMIZE (ðŸŸ¡)
	local function DoMinimize()
		Window.Visible = false
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(MiniButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = MiniButtonSize}):Play()
	end

	MinimizeBtn.MouseButton1Click:Connect(DoMinimize)

	--// RESTORE FROM MINI BUTTON
	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = FULL_SIZE}):Play()
	end)
	--// CLOSE CONFIRMATION (ðŸ”´)
	local function ShowCloseConfirm()
		SmallBtn.Active = false
		MinimizeBtn.Active = false
		CloseBtn.Active = false

		local Overlay = Instance.new("Frame")
		Overlay.Size = UDim2.new(1, 0, 1, 0)
		Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		Overlay.BackgroundTransparency = 0.7
		Overlay.ZIndex = 100
		Overlay.Parent = ScreenGui

		local Confirm = Instance.new("Frame")
		Confirm.Size = UDim2.fromOffset(360, 160)
		Confirm.Position = UDim2.fromScale(0.5, 0.5)
		Confirm.AnchorPoint = Vector2.new(0.5, 0.5)
		Confirm.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		Confirm.Parent = Overlay
		Instance.new("UICorner", Confirm).CornerRadius = UDim.new(0, 12)

		local lbl = Instance.new("TextLabel")
		lbl.Size = UDim2.new(1, -40, 0, 50)
		lbl.Position = UDim2.fromOffset(20, 20)
		lbl.Text = "Close Kaze UI?"
		lbl.TextColor3 = Color3.fromRGB(230, 230, 230)
		lbl.Font = Enum.Font.GothamBold
		lbl.TextSize = 18
		lbl.TextWrapped = true
		lbl.Parent = Confirm

		local btns = Instance.new("Frame")
		btns.Size = UDim2.new(1, 0, 0, 40)
		btns.Position = UDim2.new(0, 0, 1, -20)
		btns.Parent = Confirm

		local btnLayout = Instance.new("UIListLayout")
		btnLayout.FillDirection = Enum.FillDirection.Horizontal
		btnLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		btnLayout.Padding = UDim.new(0, 12)
		btnLayout.Parent = btns

		local confirmBtn = Instance.new("TextButton")
		confirmBtn.Size = UDim2.new(0, 120, 0, 36)
		confirmBtn.Text = "Yes"
		confirmBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
		confirmBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
		confirmBtn.Font = Enum.Font.GothamBold
		confirmBtn.Parent = btns
		Instance.new("UICorner", confirmBtn).CornerRadius = UDim.new(0, 8)
		local cancelBtn = Instance.new("TextButton")
		cancelBtn.Size = UDim2.new(0, 120, 0, 36)
		cancelBtn.Text = "No"
		cancelBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
		cancelBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
		cancelBtn.Font = Enum.Font.GothamBold
		cancelBtn.Parent = btns
		Instance.new("UICorner", cancelBtn).CornerRadius = UDim.new(0, 8)

		confirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)

		cancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			SmallBtn.Active = true
			MinimizeBtn.Active = true
			CloseBtn.Active = true
		end)
	end

	CloseBtn.MouseButton1Click:Connect(ShowCloseConfirm)

	--// Optional callback
	if typeof(Callback) == "function" then
		pcall(Callback)
	end

	return {
		Window = Window,
		Content = Content,
		Icon = Icon,
		MiniButton = MiniButton,
		SmallBtn = SmallBtn,
		MinimizeBtn = MinimizeBtn,
		CloseBtn = CloseBtn
	}
end

return KazeUI
