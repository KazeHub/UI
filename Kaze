--// Kaze UI Library v2.0
--// WindUI-inspired modular, theme-driven, mobile-friendly
--// Author: Kazu (inspired by Kaze)
--// Date: 2026-01-29

local Kaze = {}
Kaze.__index = Kaze

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Create ScreenGui (singleton)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// UIScale for responsive design
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	UIScale.Scale = size.X < 600 and math.clamp(size.X / 800, 0.5, 1) or math.clamp(size.X / 1920, 0.6, 1)
end

UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// === THEME SYSTEM ===
local DefaultTheme = {
	-- Window
	WindowBG = Color3.fromRGB(20, 20, 25),
	TopBarBG = Color3.fromRGB(15, 15, 20),
	NeonColor1 = Color3.fromRGB(0, 160, 255),
	NeonColor2 = Color3.fromRGB(0, 255, 255),
	NeonThickness = 2.5,
	
	-- Text
	TitleColor = Color3.fromRGB(235, 235, 235),
	SubTitleColor = Color3.fromRGB(160, 160, 160),
	
	-- Buttons
	ButtonBG = Color3.fromRGB(25, 25, 30),
	CloseButtonColor = Color3.fromRGB(255, 90, 90),
	MinimizeButtonColor = Color3.fromRGB(220, 220, 220),	ConfirmButton = Color3.fromRGB(0, 170, 255),
	CancelButton = Color3.fromRGB(45, 45, 50),
	
	-- Typography
	FontBold = Enum.Font.GothamBold,
	FontRegular = Enum.Font.Gotham,
	
	-- Layout
	WindowWidth = 650,
	WindowHeight = 420,
	TopBarHeight = 56,
	CornerRadius = 14,
	ButtonCornerRadius = 8,
	MiniButtonSize = 60,
}

--// === UTILITIES ===
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id):gsub("%D", "")
	return id == "" and "" or ("rbxassetid://" .. id)
end

local function MakeDraggable(dragPart, targetFrame)
	local dragging, dragStart, startPos
	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetFrame.Position
		end
	end)
	dragPart.InputEnded:Connect(function(input)
		if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
			dragging = false
		end
	end)
	UIS.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			if dragging and dragStart and startPos then
				local delta = input.Position - dragStart
				targetFrame.Position = UDim2.new(
					startPos.X.Scale, startPos.X.Offset + delta.X,
					startPos.Y.Scale, startPos.Y.Offset + delta.Y
				)
			end
		end
	end)
end
local function CreateNeonStroke(parent, theme)
	local stroke = Instance.new("UIStroke")
	stroke.Color = theme.NeonColor1
	stroke.Thickness = theme.NeonThickness
	stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	stroke.LineJoinMode = Enum.LineJoinMode.Bevel
	stroke.Parent = parent

	spawn(function()
		while parent and parent.Parent do
			TweenService:Create(stroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
				Color = theme.NeonColor2
			}):Play()
			task.wait(1.5)
		end
	end)
	return stroke
end

--// === FACTORY FUNCTIONS ===
local function CreateWindowFrame(theme)
	local frame = Instance.new("Frame")
	frame.Size = UDim2.fromOffset(theme.WindowWidth, theme.WindowHeight)
	frame.Position = UDim2.fromScale(0.5, 0.5)
	frame.AnchorPoint = Vector2.new(0.5, 0.5)
	frame.BackgroundColor3 = theme.WindowBG
	frame.BorderSizePixel = 0
	frame.ClipsDescendants = true
	Instance.new("UICorner", frame).CornerRadius = UDim.new(0, theme.CornerRadius)
	CreateNeonStroke(frame, theme)
	return frame
end

local function CreateTopBar(window, theme)
	local top = Instance.new("Frame")
	top.Size = UDim2.new(1, 0, 0, theme.TopBarHeight)
	top.BackgroundColor3 = theme.TopBarBG
	top.BorderSizePixel = 0
	top.Parent = window
	Instance.new("UICorner", top).CornerRadius = UDim.new(0, theme.CornerRadius)
	return top
end

local function CreateTextButton(props)
	local btn = Instance.new("TextButton")
	btn.Size = props.Size or UDim2.fromOffset(36, 36)
	btn.Position = props.Position or UDim2.new()
	btn.Text = props.Text or ""
	btn.Font = props.Font or Enum.Font.GothamBold
	btn.TextSize = props.TextSize or 16	btn.TextColor3 = props.TextColor or Color3.new(1, 1, 1)
	btn.BackgroundColor3 = props.BackgroundColor or Color3.fromRGB(30, 30, 35)
	btn.BorderSizePixel = 0
	btn.Parent = props.Parent
	Instance.new("UICorner", btn).CornerRadius = UDim.new(1, 0)
	return btn
end

local function CreateMiniButton(icon, theme)
	local btn = Instance.new("ImageButton")
	btn.Name = "MiniButton"
	btn.Size = UDim2.fromOffset(0, 0)
	btn.Visible = false
	btn.BackgroundColor3 = theme.WindowBG
	btn.BorderSizePixel = 0
	btn.ZIndex = 999
	btn.Parent = ScreenGui
	btn.SliceCenter = Rect.new(4, 4, 60, 60)
	btn.ScaleType = Enum.ScaleType.Slice

	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 12)
	Instance.new("UIPadding", btn).PaddingAll = UDim.new(0, 4)

	local img = Instance.new("ImageLabel")
	img.Size = UDim2.fromScale(1, 1)
	img.BackgroundTransparency = 1
	img.Image = icon
	img.ZIndex = 1000
	img.Parent = btn

	CreateNeonStroke(btn, theme)
	MakeDraggable(btn, btn)
	return btn
end

--// === MAIN API ===
function Kaze:CreateWindow(config)
	config = config or {}
	local theme = setmetatable(config.Theme or {}, { __index = DefaultTheme })

	local title = config.Title or "Kaze UI"
	local author = config.Author or "Unknown"
	local version = config.Version or "1.0"
	local mainIcon = FormatImage(config.Icon or "6031763447")
	local openIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")

	-- Main window
	local window = CreateWindowFrame(theme)
	window.Parent = ScreenGui
	-- Top bar
	local topBar = CreateTopBar(window, theme)
	MakeDraggable(topBar, window)

	-- Icon
	local icon = Instance.new("ImageLabel")
	icon.Size = UDim2.fromOffset(32, 32)
	icon.Position = UDim2.fromOffset(14, 12)
	icon.BackgroundTransparency = 1
	icon.Image = mainIcon
	icon.Parent = topBar
	Instance.new("UICorner", icon).CornerRadius = UDim.new(1, 0)

	-- Title
	local titleLabel = Instance.new("TextLabel")
	titleLabel.Size = UDim2.new(1, -160, 0, 22)
	titleLabel.Position = UDim2.fromOffset(56, 8)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = title
	titleLabel.TextColor3 = theme.TitleColor
	titleLabel.Font = theme.FontBold
	titleLabel.TextSize = 16
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left
	titleLabel.Parent = topBar

	-- Subtitle (Author | Version)
	local subLabel = Instance.new("TextLabel")
	subLabel.Size = UDim2.new(1, -160, 0, 18)
	subLabel.Position = UDim2.fromOffset(56, 30)
	subLabel.BackgroundTransparency = 1
	subLabel.Text = ("%s | v%s"):format(author, version)
	subLabel.TextColor3 = theme.SubTitleColor
	subLabel.Font = theme.FontRegular
	subLabel.TextSize = 13
	subLabel.TextXAlignment = Enum.TextXAlignment.Left
	subLabel.Parent = topBar

	-- Minimize Button
	local minimizeBtn = CreateTextButton({
		Parent = topBar,
		Position = UDim2.new(1, -88, 0.5, -18),
		Text = "—",
		TextColor = theme.MinimizeButtonColor,
		BackgroundColor = theme.ButtonBG,
		TextSize = 20,
	})

	-- Close Button
	local closeBtn = CreateTextButton({
		Parent = topBar,		Position = UDim2.new(1, -44, 0.5, -18),
		Text = "✕",
		TextColor = theme.CloseButtonColor,
		BackgroundColor = theme.ButtonBG,
		TextSize = 18,
	})

	-- Content area
	local content = Instance.new("Frame")
	content.Position = UDim2.fromOffset(0, theme.TopBarHeight)
	content.Size = UDim2.new(1, 0, 1, -theme.TopBarHeight)
	content.BackgroundTransparency = 1
	content.Parent = window

	-- Mini Open Button (60x60)
	local miniBtn = CreateMiniButton(openIcon, theme)

	-- Minimize Logic
	minimizeBtn.MouseButton1Click:Connect(function()
		window.Visible = false
		miniBtn.Visible = true
		TweenService:Create(miniBtn, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Size = UDim2.fromOffset(theme.MiniButtonSize, theme.MiniButtonSize)
		}):Play()
	end)

	-- Restore Logic
	miniBtn.MouseButton1Click:Connect(function()
		miniBtn.Visible = false
		window.Visible = true
		window.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Size = UDim2.fromOffset(theme.WindowWidth, theme.WindowHeight)
		}):Play()
	end)

	-- Close with Confirmation
	local function ShowCloseConfirm()
		minimizeBtn.Active = false
		closeBtn.Active = false

		local overlay = Instance.new("Frame")
		overlay.Size = UDim2.new(1, 0, 1, 0)
		overlay.BackgroundColor3 = Color3.new(0, 0, 0)
		overlay.BackgroundTransparency = 0.6
		overlay.ZIndex = 20
		overlay.Parent = window

		local confirmWin = Instance.new("Frame")
		confirmWin.Size = UDim2.fromOffset(350, 150)		confirmWin.Position = UDim2.fromScale(0.5, 0.5)
		confirmWin.AnchorPoint = Vector2.new(0.5, 0.5)
		confirmWin.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		confirmWin.ZIndex = 21
		confirmWin.Parent = overlay
		Instance.new("UICorner", confirmWin).CornerRadius = UDim.new(0, 12)

		local text = Instance.new("TextLabel")
		text.Size = UDim2.new(1, -32, 0, 48)
		text.Position = UDim2.fromOffset(16, 20)
		text.BackgroundTransparency = 1
		text.Text = "Are you sure you want to close the UI?"
		text.TextColor3 = Color3.fromRGB(230, 230, 230)
		text.Font = theme.FontBold
		text.TextSize = 18
		text.TextWrapped = true
		text.ZIndex = 22
		text.Parent = confirmWin

		local btnFrame = Instance.new("Frame")
		btnFrame.Size = UDim2.new(1, 0, 0, 40)
		btnFrame.Position = UDim2.new(0, 0, 1, -20)
		btnFrame.BackgroundTransparency = 1
		btnFrame.ZIndex = 22
		btnFrame.Parent = confirmWin

		local layout = Instance.new("UIListLayout")
		layout.FillDirection = Enum.FillDirection.Horizontal
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		layout.Padding = UDim.new(0, 16)
		layout.Parent = btnFrame

		local confirm = CreateTextButton({
			Parent = btnFrame,
			Size = UDim2.new(0, 120, 0, 36),
			Text = "Confirm",
			TextColor = Color3.fromRGB(230, 230, 230),
			BackgroundColor = theme.ConfirmButton,
			TextSize = 16,
		})
		Instance.new("UICorner", confirm).CornerRadius = UDim.new(0, theme.ButtonCornerRadius)

		local cancel = CreateTextButton({
			Parent = btnFrame,
			Size = UDim2.new(0, 120, 0, 36),
			Text = "Cancel",
			TextColor = Color3.fromRGB(220, 220, 220),
			BackgroundColor = theme.CancelButton,
			TextSize = 16,
		})		Instance.new("UICorner", cancel).CornerRadius = UDim.new(0, theme.ButtonCornerRadius)

		confirm.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)

		cancel.MouseButton1Click:Connect(function()
			overlay:Destroy()
			minimizeBtn.Active = true
			closeBtn.Active = true
		end)
	end

	closeBtn.MouseButton1Click:Connect(ShowCloseConfirm)

	-- Optional callback
	if type(config.Callback) == "function" then
		pcall(config.Callback)
	end

	-- Return public API
	return {
		Window = window,
		Content = content,
		Icon = icon,
		MiniButton = miniBtn,
		Theme = theme,
		-- Future: Add CreateTab, Button, etc. here
	}
end

return Kaze
