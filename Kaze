--// Kaze UI Base (FULL FIXED)
--// Tabs Visible + Shortcut System + Mobile Safe

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Config
local NEON_COLOR_1 = Color3.fromRGB(0, 180, 255)
local NEON_COLOR_2 = Color3.fromRGB(0, 255, 255)
local BG_COLOR = Color3.fromRGB(12, 12, 15)

--// ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// UIScale
local UIScale = Instance.new("UIScale", ScreenGui)
local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
end
UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// Helpers
local function FormatImage(id)
	id = tostring(id or "")
	local clean = id:gsub("%D", "")
	return clean ~= "" and ("rbxassetid://" .. clean) or ""
end

local function Pulse(inst, prop)
	inst[prop] = NEON_COLOR_1
	TweenService:Create(
		inst,
		TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
		{[prop] = NEON_COLOR_2}
	):Play()
end

local function MakeDraggable(drag, target)
	local dragging, startPos, startInput
	drag.InputBegan:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			startPos = target.Position
			startInput = i.Position
			i.Changed:Connect(function()
				if i.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	UIS.InputChanged:Connect(function(i)
		if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then
			local delta = i.Position - startInput
			target.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
end

--// MAIN
function KazeUI:CreateWindow(config)
	config = config or {}

	local Window = Instance.new("Frame")
	Window.Size = UDim2.fromOffset(650, 420)
	Window.Position = UDim2.fromScale(0.5, 0.5)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = BG_COLOR
	Window.Parent = ScreenGui
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 10)

	local Stroke = Instance.new("UIStroke", Window)
	Stroke.Thickness = 2
	Pulse(Stroke, "Color")

	--// TopBar
	local TopBar = Instance.new("Frame", Window)
	TopBar.Size = UDim2.new(1, 0, 0, 50)
	TopBar.BackgroundColor3 = BG_COLOR
	MakeDraggable(TopBar, Window)

	local Line = Instance.new("Frame", TopBar)
	Line.Size = UDim2.new(1, 0, 0, 2)
	Line.Position = UDim2.new(0, 0, 1, 0)
	Pulse(Line, "BackgroundColor3")

	--// Content
	local Content = Instance.new("Frame", Window)
	Content.Position = UDim2.fromOffset(0, 52)
	Content.Size = UDim2.new(1, 0, 1, -52)
	Content.BackgroundTransparency = 1

	--// Tabs
	local TAB_WIDTH = 130
	local TabsContainer = Instance.new("Frame", Content)
	TabsContainer.Size = UDim2.new(0, TAB_WIDTH, 1, 0)
	TabsContainer.BackgroundColor3 = BG_COLOR
	Instance.new("UICorner", TabsContainer).CornerRadius = UDim.new(0, 10)

	local Divider = Instance.new("Frame", TabsContainer)
	Divider.Size = UDim2.new(0, 2, 1, 0)
	Divider.Position = UDim2.new(1, 0, 0, 0)
	Pulse(Divider, "BackgroundColor3")

	--// SCROLL FIX (IMPORTANT)
	local TabsScroll = Instance.new("ScrollingFrame", TabsContainer)
	TabsScroll.Size = UDim2.new(1, -6, 1, -10)
	TabsScroll.Position = UDim2.fromOffset(3, 5)
	TabsScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
	TabsScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
	TabsScroll.ScrollBarThickness = 0
	TabsScroll.BackgroundTransparency = 1
	TabsScroll.ClipsDescendants = true

	local List = Instance.new("UIListLayout", TabsScroll)
	List.Padding = UDim.new(0, 8)

	--// Pages
	local Pages = Instance.new("Frame", Content)
	Pages.Size = UDim2.new(1, -TAB_WIDTH - 2, 1, 0)
	Pages.Position = UDim2.new(0, TAB_WIDTH + 2, 0, 0)
	Pages.BackgroundTransparency = 1

	--// TAB SYSTEM
	local tabs = {}
	local activeTab

	local function SetActiveTab(index)
		for i, t in ipairs(tabs) do
			t.Page.Visible = (i == index)
			t.Stroke.Enabled = (i == index)
		end
		activeTab = index
	end

	local function AddTab(name)
		local index = #tabs + 1

		local Btn = Instance.new("TextButton", TabsScroll)
		Btn.Size = UDim2.new(1, -8, 0, 40)
		Btn.Text = name
		Btn.BackgroundColor3 = Color3.fromRGB(15,15,18)
		Btn.TextColor3 = Color3.fromRGB(230,230,230)
		Btn.Font = Enum.Font.GothamMedium
		Btn.TextSize = 14
		Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 8)

		local BtnStroke = Instance.new("UIStroke", Btn)
		BtnStroke.Thickness = 1.5
		BtnStroke.Enabled = false
		Pulse(BtnStroke, "Color")

		local Page = Instance.new("Frame", Pages)
		Page.Size = UDim2.new(1, -20, 1, -20)
		Page.Position = UDim2.fromOffset(10, 10)
		Page.Visible = false
		Page.BackgroundTransparency = 1

		Btn.MouseButton1Click:Connect(function()
			SetActiveTab(index)
		end)

		table.insert(tabs, {
			Btn = Btn,
			Page = Page,
			Stroke = BtnStroke
		})

		if index == 1 then
			SetActiveTab(1)
		end

		return Page
	end

	--// SHORTCUT SYSTEM
	local Shortcuts = {}

	local function RegisterShortcut(key, tabIndex)
		if not tabs[tabIndex] then return end
		if typeof(key) ~= "table" then key = {key} end
		for _, k in ipairs(key) do
			if typeof(k) == "string" and Enum.KeyCode[k] then
				Shortcuts[Enum.KeyCode[k]] = tabIndex
			elseif typeof(k) == "EnumItem" then
				Shortcuts[k] = tabIndex
			end
		end
	end

	UIS.InputBegan:Connect(function(i, gp)
		if gp then return end
		if i.UserInputType == Enum.UserInputType.Keyboard then
			local idx = Shortcuts[i.KeyCode]
			if idx then
				SetActiveTab(idx)
			end
		end
	end)

	return {
		Window = Window,
		AddTab = AddTab,
		RegisterShortcut = RegisterShortcut
	}
end

return KazeUI
